<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Just for fun</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhongyuehui.github.io/"/>
  <updated>2019-08-08T13:06:49.016Z</updated>
  <id>https://zhongyuehui.github.io/</id>
  
  <author>
    <name>zhong yuehui</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Express路由的模块化</title>
    <link href="https://zhongyuehui.github.io/2019/08/08/Express%E8%B7%AF%E7%94%B1%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    <id>https://zhongyuehui.github.io/2019/08/08/Express路由的模块化/</id>
    <published>2019-08-08T13:03:26.000Z</published>
    <updated>2019-08-08T13:06:49.016Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在每个项目中，路由的使用是必不可少的，尤其是大型项目中，规则的配置路由会在我们后期维护代码的时候显得非常方便，就相当于给每个页面或功能归类，修改找到类别就定位到了需要修改的地方。</p></blockquote><a id="more"></a><h2 id="Express的模块化路由"><a href="#Express的模块化路由" class="headerlink" title="Express的模块化路由"></a>Express的模块化路由</h2><h3 id="什么是模块化路由？"><a href="#什么是模块化路由？" class="headerlink" title="什么是模块化路由？"></a>什么是模块化路由？</h3><ul><li><p>模块化路由就是将某些功能或类型相同的路由生成到一个模块中，比如：商品功能的服务，有上传修改删除等功能，我们需要单独的封装成一个路由模块</p><h3 id="为什么要模块化路由"><a href="#为什么要模块化路由" class="headerlink" title="为什么要模块化路由"></a>为什么要模块化路由</h3></li><li><p>方便后期维护，减少代码冗余</p><h3 id="Express模块化路由"><a href="#Express模块化路由" class="headerlink" title="Express模块化路由"></a>Express模块化路由</h3></li><li><p>Express中我们使用<code>const router=express.Router()</code>来进行路由的模块化</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/routers/admin.js</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="hljs-string">'admin'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//暴露这个模块</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure></li><li><p>这样就暴露了管理模块的路由</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//app.js</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//引入路由模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> admin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routers/admin'</span>)</span><br><span class="line"></span><br><span class="line">app.use(<span class="hljs-string">'/admin'</span>, admin)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`http://localhost:`</span> + port))</span><br></pre></td></tr></table></figure></li><li><p>然后，我们通过中间件的配置方式，配置路由模块，这样我们可以通过<code>http://localhost:3000/admin</code>访问到<code>admin</code>模块中的<code>/</code>路由；<code>http://localhost:3000/admin</code>中的admin就相当于路由模块</p></li><li><p>当然，我们可以在admin中引入<code>login</code>、<code>resgin</code>等模块，然后在<code>login</code>,<code>resgin</code>模块中来处理相关的模块，这样就形成了路由层层嵌套</p><h3 id="路由嵌套"><a href="#路由嵌套" class="headerlink" title="路由嵌套"></a>路由嵌套</h3></li><li><p>示例：我们在app中写入一些所有模块都需要的一些插件，还有配置主模块，因为在大型的项目中可能有许多的模块，如管理模块，用户模块等等,之后可以通过<code>http://localhost:3000/admin</code>访问管理模块,<code>http://localhost:3000/user</code>访问用户模块等等</p></li><li><p>在这里我们只以管理模块做示范，通过中间件的形式配置</p>  <figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//app.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express-session'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> admin = <span class="hljs-keyword">require</span>(<span class="hljs-string">'./routers/admin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//表示使用ejs模板引擎，当然你也可以使用art-template模板引擎</span></span><br><span class="line">app.set(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>)</span><br><span class="line">app.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(<span class="hljs-string">'./public'</span>))</span><br><span class="line">app.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/uploadImages'</span>, express.<span class="hljs-keyword">static</span>(<span class="hljs-string">'./uploadImages'</span>))<span class="hljs-comment">//配置图片地址文件夹</span></span><br><span class="line"><span class="hljs-comment">//配置session</span></span><br><span class="line">app.<span class="hljs-keyword">use</span>(session(&#123;</span><br><span class="line">    secret: <span class="hljs-string">'keyboard cat'</span>,</span><br><span class="line">    resave: <span class="hljs-keyword">false</span>,</span><br><span class="line">    saveUninitialized: <span class="hljs-keyword">true</span>,</span><br><span class="line">    cookie: &#123;</span><br><span class="line">        maxAge: <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">30</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    rolling: <span class="hljs-keyword">true</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/'</span>, index)</span><br><span class="line">app.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/admin'</span>, admin)</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; console.log(`http:<span class="hljs-comment">//localhost:` + port))</span></span><br></pre></td></tr></table></figure></li><li><p>这里我们在admin中引入admin/的子路由模块，到时候可以通过<code>http://localhost:3000/admin/xxx</code>访问</p>  <figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//admin.js</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//引入模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> login = <span class="hljs-keyword">require</span>(<span class="hljs-string">'../routers/admin/login'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> product = <span class="hljs-keyword">require</span>(<span class="hljs-string">'./admin/product.js'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">require</span>(<span class="hljs-string">'../routers/admin/user'</span>)</span><br><span class="line"></span><br><span class="line">router.<span class="hljs-keyword">use</span>((req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (req.url == <span class="hljs-string">'/login'</span> || req.url == <span class="hljs-string">'/login/dologin'</span> || req.url == <span class="hljs-string">'/login/resgin'</span> || req.url == <span class="hljs-string">'/logoin/doresgin'</span>) &#123;  <span class="hljs-comment">//除去这两个</span></span><br><span class="line">        next()</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (req.session.userinfo &amp;&amp; req.session.userinfo.username != <span class="hljs-string">''</span>) &#123;  <span class="hljs-comment">//判断是否有用户信息</span></span><br><span class="line">            <span class="hljs-comment">//使用ejs设置全局属性，可以在任意的ejs模板中获取</span></span><br><span class="line">            req.app.locals[<span class="hljs-string">'userinfo'</span>] = req.session.userinfo</span><br><span class="line">            next()</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            res.redirect(<span class="hljs-string">'/admin/login'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置路由中间件，到时候只需要http://localhost:3000/admim/login就可以访问login模块的路由</span></span><br><span class="line">router.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/login'</span>, login)</span><br><span class="line">router.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/product'</span>, product)</span><br><span class="line">router.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/user'</span>, user)</span><br><span class="line"><span class="hljs-comment">//暴露这个模块</span></span><br><span class="line">module.exports = router</span><br></pre></td></tr></table></figure></li><li><p>在这里我们继续做路由的详细的处理，到时候可以通过<code>http://localhost:3000/admin/xxx/xxx</code>访问，示例,<code>http://localhost:3000/admin/login/xxx</code></p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//login.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> router = express.Router()</span><br><span class="line"><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> DB = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../modules/db'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> md5s = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../md5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// //引入并配置body-parser中间件,并按需引入</span></span><br><span class="line"><span class="hljs-keyword">const</span> jsonParser = bodyParser.json()</span><br><span class="line"><span class="hljs-keyword">const</span> urlencodedParser = bodyParser.urlencoded(&#123; extended: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//登陆页面</span></span><br><span class="line">router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'admin/login/login'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//验证登陆表单</span></span><br><span class="line">router.post(<span class="hljs-string">'/dologin'</span>, urlencodedParser, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//将数据重新转换一下，因为req.body有一些没有作用的数据</span></span><br><span class="line">    <span class="hljs-keyword">let</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body))</span><br><span class="line">    DB.find(<span class="hljs-string">'user'</span>, &#123; <span class="hljs-string">"username"</span>: body.username, <span class="hljs-string">"password"</span>: md5s.md5(body.password) &#125;, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-keyword">if</span> (result.length &gt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">//如果大于0表示有数据</span></span><br><span class="line">            req.session.userinfo = result[<span class="hljs-number">0</span>]  <span class="hljs-comment">//将用户数据保存到session中</span></span><br><span class="line">            res.status = <span class="hljs-number">200</span></span><br><span class="line">            res.redirect(<span class="hljs-string">'/admin/product'</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//如果等于0表示没有数据</span></span><br><span class="line">            res.status = <span class="hljs-number">300</span></span><br><span class="line">            res.send(<span class="hljs-string">'&lt;script&gt;alert(\'用户名或密码错误\');location.href="/admin/login"&lt;/script&gt;'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//注册页面</span></span><br><span class="line">router.get(<span class="hljs-string">'/resgin'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'admin/login/resgin'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//注册表单</span></span><br><span class="line">router.post(<span class="hljs-string">'/resgin'</span>, urlencodedParser, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body))</span><br><span class="line">    body.password = md5s.md5(body.password)  <span class="hljs-comment">//将密码进行加密</span></span><br><span class="line">    DB.find(<span class="hljs-string">'user'</span>, &#123; <span class="hljs-string">"username"</span>: body.username &#125;, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-keyword">if</span> (result.length &gt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">//如果大于0表示有数据,不能注册</span></span><br><span class="line">            res.send(<span class="hljs-string">'&lt;script&gt;alert("此用户已被注册");location.href="/admin/resgin"&lt;/script&gt;'</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//如果等于0表示没有数据</span></span><br><span class="line">            DB.insertOne(<span class="hljs-string">'user'</span>, body, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">                res.send(<span class="hljs-string">'&lt;script&gt;alert("注册成功，即将前往登陆页面");location.href="/admin/login"&lt;/script&gt;'</span>)</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//退出</span></span><br><span class="line">router.get(<span class="hljs-string">'/loginout'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//销毁session</span></span><br><span class="line">    req.session.destroy(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        res.redirect(<span class="hljs-string">'admin/login'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//暴露这个模块</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure></li><li><p>以上我作出了模块化路由的嵌套，如果你想详细了解代码，可以在我的<code>github</code>中下载源码，进行查看。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在每个项目中，路由的使用是必不可少的，尤其是大型项目中，规则的配置路由会在我们后期维护代码的时候显得非常方便，就相当于给每个页面或功能归类，修改找到类别就定位到了需要修改的地方。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>Nodejs配置MD5加密</title>
    <link href="https://zhongyuehui.github.io/2019/08/06/Nodejs%E9%85%8D%E7%BD%AEMD5%E5%8A%A0%E5%AF%86/"/>
    <id>https://zhongyuehui.github.io/2019/08/06/Nodejs配置MD5加密/</id>
    <published>2019-08-06T08:21:49.000Z</published>
    <updated>2019-08-06T08:24:10.803Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在服务端语言中，加密数据是必不可少的，这关系到用户的数据的安全性，我们在一般的使用加密数据时，md5加密用户的密码等信息使用尤其广泛</p></blockquote><a id="more"></a><h2 id="Nodejs配置MD5加密"><a href="#Nodejs配置MD5加密" class="headerlink" title="Nodejs配置MD5加密"></a>Nodejs配置MD5加密</h2><h3 id="MD5算法"><a href="#MD5算法" class="headerlink" title="MD5算法"></a>MD5算法</h3><p>MD5是计算机领域使用最广泛的散列函数(可以叫哈希算法、摘要算法)，注意是用来确保消息的完整和一致性。<br>下面我们最主要是以 md5 加密为例来了解下加密算法。<br>MD5算法有以下特点：</p><ol><li>压缩性： 任意长度的数据，算出的MD5值长度都是固定的。</li><li>容易计算：从原数据算出MD5值很容易。</li><li>抗修改性：对原数据进行任何改动，哪怕只修改一个字节，所得到的MD5值都有很大的区别。</li><li>强抗碰撞：已知原数据和其MD5值，想找到一个具有相同的MD5值的伪数据是非常困难的。<h3 id="在nodejs中使用md5加密"><a href="#在nodejs中使用md5加密" class="headerlink" title="在nodejs中使用md5加密"></a>在nodejs中使用md5加密</h3></li></ol><ul><li><p>使用自带的加密模块<code>crypto</code></p></li><li><p>引入模块:<code>const crypto = require(&#39;crypto&#39;);</code></p></li><li><p>创建一个hash对象<code>const md5=crypto.createHash(&#39;md5&#39;);</code></p></li><li><p>往hash对象中添加要摘要的内容<code>md5.update(str);</code></p></li><li><p>使用digest方法输出内容，如果不适用编码格式的参数，输出的是一个<code>Buffer</code>对象</p>  <figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">md5</span><span class="hljs-selector-class">.digest</span>());</span><br></pre></td></tr></table></figure></li><li><p>使用编码格式的参数，输出的是一个字符串格式的摘要内容</p>  <figure class="highlight 1c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="hljs-built_in">log</span>(md5.digest('hex')); <span class="hljs-comment">// 输出 900150983cd24fb0d6963f7d28e17f72</span></span><br></pre></td></tr></table></figure></li><li><p>完整示例代码如下:</p>  <figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> crypto = require(<span class="hljs-string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-built_in">str</span> = <span class="hljs-string">'abc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 创建一个hash对象</span></span><br><span class="line"><span class="hljs-keyword">const</span> md5 = crypto.createHash(<span class="hljs-string">'md5'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 往hash对象中添加摘要内容</span></span><br><span class="line">md5.update(<span class="hljs-built_in">str</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用 digest 方法输出摘要内容，不使用编码格式的参数 其输出的是一个Buffer对象</span></span><br><span class="line"><span class="hljs-comment">// console.log(md5.digest()); </span></span><br><span class="line"><span class="hljs-comment">// 输出 &lt;Buffer 90 01 50 98 3c d2 4f b0 d6 96 3f 7d 28 e1 7f 72&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用编码格式的参数，输出的是一个字符串格式的摘要内容</span></span><br><span class="line">console.<span class="hljs-built_in">log</span>(md5.digest(<span class="hljs-string">'hex'</span>)); <span class="hljs-comment">// 输出 900150983cd24fb0d6963f7d28e17f72</span></span><br></pre></td></tr></table></figure></li><li><p>但是经过我的实践，发现这个md5如果直接在一个页面上添加摘要内容再输出，只能有一次，如果使用第二次就会报错，如果我们再处理用户的密码的时候往往需要使用加密，所以我们需要将这个md5单独的封装成一个模块，使用的时候调用这个模块即可</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//md5.js</span></span><br><span class="line"></span><br><span class="line">exports.md5 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>&#123; <span class="hljs-comment">//暴露出md5s方法</span></span><br><span class="line"><span class="hljs-keyword">var</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>)  <span class="hljs-comment">//加载加密文件</span></span><br><span class="line"><span class="hljs-keyword">var</span> md5 = crypto.createHash(<span class="hljs-string">'md5'</span>)</span><br><span class="line">md5.update(str)</span><br><span class="line">str = md5.digest(<span class="hljs-string">'hex'</span>)</span><br><span class="line"><span class="hljs-keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>这个时候我们使用只需要调用这个模块就行了</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> md5s=<span class="hljs-built_in">require</span>(<span class="hljs-string">'./md5'</span>) <span class="hljs-comment">//调用模块</span></span><br><span class="line">md5s.md5(str) <span class="hljs-comment">//使用模块中的方法并传入str</span></span><br></pre></td></tr></table></figure></li><li><p>这样就不受限制了，可以一直使用。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在服务端语言中，加密数据是必不可少的，这关系到用户的数据的安全性，我们在一般的使用加密数据时，md5加密用户的密码等信息使用尤其广泛&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Express-session的使用</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Express-session%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Express-session的使用/</id>
    <published>2019-08-04T14:08:48.000Z</published>
    <updated>2019-08-04T14:13:57.804Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>session是另一种记录客户状态的机制，不同的cookie保存在客户端的浏览器中，而session保存在服务器上</p></blockquote><a id="more"></a><h1 id="Session的使用"><a href="#Session的使用" class="headerlink" title="Session的使用"></a>Session的使用</h1><h2 id="什么是session"><a href="#什么是session" class="headerlink" title="什么是session"></a>什么是session</h2><ul><li><p>session是另一种记录客户状态的机制，不同的cookie保存在客户端的浏览器中，而session保存在服务器上</p><h3 id="session的用途"><a href="#session的用途" class="headerlink" title="session的用途"></a>session的用途</h3></li><li><p>session运行在服务器端，当客户端第一次访问服务器时，可以将客户的登录信息保存。<br>当客户访问其他页面时，可以判断客户的登录状态，做出提示，相当于登录拦截。</p></li><li><p>session可以和Redis或者数据库等结合做持久化操作，当服务器挂掉时也不会导致某些客户信息（购物车）丢失。</p><h3 id="Session的工作流程"><a href="#Session的工作流程" class="headerlink" title="Session的工作流程"></a>Session的工作流程</h3></li><li><p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个session对象，生成一个类似于key,value的键值对，然后将key(cookie)返回到浏览器(客户)端，浏览器下次再访问时，携带key(cookie)，找到对应的session(value)。客户的信息都保存在session中<br><img src="https://s2.ax1x.com/2019/08/04/eylZMn.jpg" alt="session"></p><h3 id="session的使用"><a href="#session的使用" class="headerlink" title="session的使用"></a>session的使用</h3></li><li><p>安装:<code>cnpm i express-session -save</code></p></li><li><p>引入：</p>  <figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> session = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express-session'</span>)`</span><br><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"><span class="hljs-keyword">const</span> session = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express-session'</span>)</span><br><span class="line"><span class="hljs-comment">//配置中间件</span></span><br><span class="line">app.<span class="hljs-keyword">use</span>(session(&#123;</span><br><span class="line">    secret: <span class="hljs-string">'keyboard cat'</span>,</span><br><span class="line">    resave: <span class="hljs-keyword">false</span>,</span><br><span class="line">    saveUninitialized: <span class="hljs-keyword">true</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (req.session.username) &#123;  <span class="hljs-comment">//判断session</span></span><br><span class="line">        res.send(<span class="hljs-string">'欢迎你'</span> + req.session.username)  <span class="hljs-comment">//获取session</span></span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="hljs-string">'未登陆'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setsession'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    req.session.username = <span class="hljs-string">"zs"</span>  <span class="hljs-comment">//设置session</span></span><br><span class="line">    res.send(<span class="hljs-string">'session设置成功'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; res.send(<span class="hljs-string">'Hello World!'</span>))</span><br><span class="line">app.listen(port, () =&gt; console.log(`Example app listening on port port!`))</span><br></pre></td></tr></table></figure></li><li><p>与cookie不同的是，cookie获取数据是在request请求的时候获取，设置数据是response响应的时候设置，因为这个时候才可以获得需要设置的数据，比如路由传递的值，但是session都是在请求的时候获取和发送，因为获取也要去服务端中进行key/value的验证，而设置的时候value也是设置到服务端去的，所以需要在请求的时候带上要设置的数据</p></li><li><p>cookie中只要数据不过期，就可以一直使用，但是session只要你关闭了浏览器，本地数据就没了，需要重新请求</p><h3 id="session的一些配置项"><a href="#session的一些配置项" class="headerlink" title="session的一些配置项"></a>session的一些配置项</h3><p>参数|作用</p></li><li><p>-|:–:|<br>secret|一个 String 类型的字符串，作为服务器端生成 session 的签名。<br>name | 返回客户端的 key 的名称，默认为 connect.sid,也可以自己设置。<br>resave | 强制保存 session 即使它并没有变化,。默认为 true。建议设置成 false。 don’tsavesessionifunmodified<br>saveUninitialized | 强制将未初始化的session存储。当新建了一个session且未设定属性或值时，它就处于未初始化状态。在设定一个 cookie 前，这对于登陆验证，减轻服务端存储压力，权限控制是有帮助的。（默 认：true）。建议手动添加。<br>cookie | 设置返回到前端 key 的属性，默认值为{path: ‘/’, httpOnly: true,secure:false,maxAge: null}。<br>rolling | 在每次请求时强行设置 cookie，这将重置 cookie 过期时间（默认：false）</p></li><li><p>相关的使用</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>)</span><br><span class="line"><span class="hljs-comment">//配置中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="hljs-string">'keyboard cat'</span>,  <span class="hljs-comment">//这个字符可以随便写，生命session的前面，但是一般不要些太长</span></span><br><span class="line">    name: <span class="hljs-string">'session_id'</span>,<span class="hljs-comment">//保存到cookie的名称，默认是connect_sid 可以不设置</span></span><br><span class="line">    resave: <span class="hljs-literal">false</span>, <span class="hljs-comment">//强制保存session 即使它没变化，一一般我们是设置有变化再保存</span></span><br><span class="line">    saveUninitialized: <span class="hljs-literal">true</span>, <span class="hljs-comment">//强制将未初始化的session存储，就是你没有session的时候会帮你建一个名为session_id的cookie</span></span><br><span class="line">    cookie: &#123;  <span class="hljs-comment">//这里的cookie设置与express-cookie相似</span></span><br><span class="line">        maxAge: <span class="hljs-number">50000</span>  <span class="hljs-comment">//过期时间，就算不关闭窗口也会过期</span></span><br><span class="line">    &#125;,</span><br><span class="line">    rolling: <span class="hljs-literal">true</span>  <span class="hljs-comment">//只要你在操作，每次操作重置cookie的过期时间</span></span><br><span class="line"></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (req.session.username) &#123;  <span class="hljs-comment">//判断session</span></span><br><span class="line">        res.send(<span class="hljs-string">'欢迎你'</span> + req.session.username)  <span class="hljs-comment">//获取session</span></span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="hljs-string">'未登陆'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="hljs-string">'登陆成功'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setsession'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    req.session.username = <span class="hljs-string">"zs"</span>  <span class="hljs-comment">//设置session</span></span><br><span class="line">    res.send(<span class="hljs-string">'session设置成功'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="session的常用方法"><a href="#session的常用方法" class="headerlink" title="session的常用方法"></a>session的常用方法</h3><ul><li>注意：设置和获取都是在request请求中的，因为session的value是传递到服务端的，所以需要在请求的时候传递过去，而获取是根据key来向服务端获取value的，也需要在请求的时候验证</li></ul><ol><li><p>设置session</p> <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req<span class="hljs-selector-class">.session</span>.(key)=<span class="hljs-string">"(value)"</span></span><br><span class="line">如：</span><br><span class="line">req<span class="hljs-selector-class">.sesssion</span><span class="hljs-selector-class">.username</span>=<span class="hljs-string">"zs"</span></span><br></pre></td></tr></table></figure></li><li><p>获取session</p> <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req<span class="hljs-selector-class">.session</span>.(key)</span><br><span class="line">如：</span><br><span class="line">req<span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.username</span></span><br></pre></td></tr></table></figure></li><li><p>重新设置过期时间</p> <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req<span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.cookie</span><span class="hljs-selector-class">.maxAge</span>=<span class="hljs-number">60000</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="session的销毁"><a href="#session的销毁" class="headerlink" title="session的销毁"></a>session的销毁</h3><ul><li><p>如果我们在过期时间内想要退出账号，那么必须销毁session</p>  <figure class="highlight coffeescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="hljs-string">'/loginOut'</span>, <span class="hljs-function"><span class="hljs-params">(req, res)</span> =&gt;</span> &#123;</span><br><span class="line"><span class="hljs-regexp">//</span> req.session.cookie.maxAge = <span class="hljs-number">0</span>  //重新设置cookie的过期时间为<span class="hljs-number">0</span>，马上过期 实现账号的退出</span><br><span class="line">req.session.destroy(<span class="hljs-function"><span class="hljs-params">(req, res)</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"销毁成功"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">res.send(<span class="hljs-string">'退出登陆'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>销毁session的两种方式</p></li></ul><ol><li>设置过期时间为0</li><li>使用destory来主动销毁session<h3 id="session的负载均衡"><a href="#session的负载均衡" class="headerlink" title="session的负载均衡"></a>session的负载均衡</h3></li></ol><ul><li><p>一般的我们都是将session保存到数据库中，请求的时候通过Nginx判断服务器负载信息，比如广州的用户数据在广州的服务器，而且有两台这个时候Nginx做出负载判断后随机向负载教低的服务器传送数据，服务器再去数据库中取数据返回到我们的客户端中，这个就是负载均衡</p><h4 id="将session保存到数据库中"><a href="#将session保存到数据库中" class="headerlink" title="将session保存到数据库中"></a>将session保存到数据库中</h4></li><li><p>首先需要安装两个模块</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm <span class="hljs-selector-tag">i</span> express-session --save  <span class="hljs-comment">//session模块</span></span><br><span class="line">cnpm <span class="hljs-selector-tag">i</span> connect-mongo --save   <span class="hljs-comment">//连接数据库的模块</span></span><br></pre></td></tr></table></figure></li><li><p>配置并使用</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>)</span><br><span class="line"><span class="hljs-comment">//使用connect-mongo</span></span><br><span class="line"><span class="hljs-keyword">const</span> MongoStore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-mongo'</span>)(session)</span><br><span class="line"><span class="hljs-comment">//配置中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="hljs-string">'keyboard cat'</span>,  <span class="hljs-comment">//这个字符可以随便写，生命session的前面，但是一般不要些太长</span></span><br><span class="line">    name: <span class="hljs-string">'session_id'</span>,<span class="hljs-comment">//保存到cookie的名称，默认是connect_sid 可以不设置</span></span><br><span class="line">    resave: <span class="hljs-literal">false</span>, <span class="hljs-comment">//强制保存session 即使它没变化，一一般我们是设置有变化再保存</span></span><br><span class="line">    saveUninitialized: <span class="hljs-literal">true</span>, <span class="hljs-comment">//强制将未初始化的session存储，就是你没有session的时候会帮你建一个名为session_id的cookie</span></span><br><span class="line">    cookie: &#123;  <span class="hljs-comment">//这里的cookie设置与express-cookie相似</span></span><br><span class="line">        maxAge: <span class="hljs-number">5000</span>  <span class="hljs-comment">//过期时间，就算不关闭窗口也会过期</span></span><br><span class="line">    &#125;,</span><br><span class="line">    rolling: <span class="hljs-literal">true</span>,  <span class="hljs-comment">//只要你在操作，每次操作重置cookie的过期时间</span></span><br><span class="line">    store: <span class="hljs-keyword">new</span> MongoStore(&#123;  <span class="hljs-comment">//连接数据库</span></span><br><span class="line">        url: <span class="hljs-string">'mongodb://127.0.0.1:27017/study'</span>, <span class="hljs-comment">//数据库的地址</span></span><br><span class="line">        touchAfter: <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>  <span class="hljs-comment">//设置时间</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (req.session.username) &#123;  <span class="hljs-comment">//判断session</span></span><br><span class="line">        res.send(<span class="hljs-string">'欢迎你'</span> + req.session.username)  <span class="hljs-comment">//获取session</span></span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="hljs-string">'未登陆'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="hljs-string">'登陆成功'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setsession'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    req.session.username = <span class="hljs-string">"ls"</span>  <span class="hljs-comment">//设置session</span></span><br><span class="line">    res.send(<span class="hljs-string">'session设置成功'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/loginOut'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// req.session.cookie.maxAge = 0  //重新设置cookie的过期时间为0，马上过期 实现账号的退出</span></span><br><span class="line">    req.session.destroy(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"销毁成功"</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    res.send(<span class="hljs-string">'退出登陆'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>这个时候我们设置的session就会保存到数据库中去了</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;session是另一种记录客户状态的机制，不同的cookie保存在客户端的浏览器中，而session保存在服务器上&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>Nodejs连接并操作MongoDB数据库</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Nodejs%E8%BF%9E%E6%8E%A5%E5%B9%B6%E6%93%8D%E4%BD%9CMongoDB%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Nodejs连接并操作MongoDB数据库/</id>
    <published>2019-08-04T14:06:47.000Z</published>
    <updated>2019-08-05T09:30:06.171Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用原生的Ndeojs来操作数据库进行增删改查</p></blockquote><a id="more"></a><h1 id="Nodejs连接并操作MongoDB数据库"><a href="#Nodejs连接并操作MongoDB数据库" class="headerlink" title="Nodejs连接并操作MongoDB数据库"></a>Nodejs连接并操作MongoDB数据库</h1><ul><li>在项目中安装生产依赖项:<code>cnpm i mongodb --save-dev</code><h2 id="连接并创建数据库"><a href="#连接并创建数据库" class="headerlink" title="连接并创建数据库"></a>连接并创建数据库</h2></li><li>要在 MongoDB 中创建一个数据库，首先我们需要创建一个 MongoClient 对象，然后配置好指定的 URL 和 端口号。如果数据库不存在，MongoDB 将创建数据库并建立连接。</li><li>创建连接  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/student"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"> </span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库已创建!"</span>); <span class="hljs-comment">//成功则打印创建成功</span></span><br><span class="line">  db.close(); <span class="hljs-comment">//关闭数据库</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><ul><li><p>使用<code>createCollection()</code>方法来创建集合</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库，并使用新的url解析器，这是新版的</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库已创建!"</span>); <span class="hljs-comment">//成功则打印创建成功</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要创建集合的数据库</span></span><br><span class="line">    dbase.createCollection(<span class="hljs-string">'students'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123;  <span class="hljs-comment">//创建集合students</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"集合已创建"</span>);</span><br><span class="line">        db.close(); <span class="hljs-comment">//关闭数据库</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>注意：此时因为没有插入数据，所以数据表(集合不会显示)</p><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><h4 id="插入一条数据"><a href="#插入一条数据" class="headerlink" title="插入一条数据"></a>插入一条数据</h4></li><li><p>我们使用<code>insertOne()</code>表示插入一条数据，使用这个方法插入多条会报错</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库已创建!"</span>); <span class="hljs-comment">//成功则打印创建成功</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要插入信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> mydata = &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"hobby"</span>: [<span class="hljs-string">"看电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span>] &#125;  <span class="hljs-comment">//准备插入的信息</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).insertOne(mydata, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//插入到student数据库的students表中</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"信息插入成功"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>这个时候信息插入成功后就可以查看信息了</p>  <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    &gt; db.students.<span class="hljs-builtin-name">find</span>()</span><br><span class="line">    &#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f4aac5878526fc1e4dff"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"看</span></span><br><span class="line"><span class="hljs-string">电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="插入多条数据"><a href="#插入多条数据" class="headerlink" title="插入多条数据"></a>插入多条数据</h3><ul><li><p>我们使用<code>insertMany()</code>插入多条数据的对象</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据库已创建!"</span>); <span class="hljs-comment">//成功则打印创建成功</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要插入信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> mydata = [</span><br><span class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"hobby"</span>: [<span class="hljs-string">"看电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span>] &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">13</span>, <span class="hljs-string">"hobby"</span>: [<span class="hljs-string">"吃饭"</span>, <span class="hljs-string">"睡觉"</span>, <span class="hljs-string">"打游戏"</span>] &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"wangmazi"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">15</span>, <span class="hljs-string">"hobby"</span>: [<span class="hljs-string">"打牌"</span>, <span class="hljs-string">"看电视"</span>, <span class="hljs-string">"看书"</span>] &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ]  <span class="hljs-comment">//准备插入的信息</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).insertMany(mydata, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//插入到student数据库的students表中</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"信息插入成功"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>插入完成后我们就可以看到这些数据了</p>  <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.students.<span class="hljs-builtin-name">find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"看</span></span><br><span class="line"><span class="hljs-string">电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span> ] &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318ce"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"age"</span> : 13, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"吃饭"</span>, <span class="hljs-string">"睡觉"</span>, <span class="hljs-string">"打游戏"</span> ] &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"wangmazi"</span>, <span class="hljs-string">"age"</span> : 15, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"打牌"</span>, <span class="hljs-string">"看电视"</span>, <span class="hljs-string">"看书"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><ul><li>使用<code>find()</code>来查找数据，<code>find()</code>可以返回匹配条件的所有数据,如果未指定匹配条件，则返回集合内的所有数据<h5 id="无条件查询"><a href="#无条件查询" class="headerlink" title="无条件查询"></a>无条件查询</h5></li><li>不使用条件查询，查询所有数据  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要查询信息的数据库</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).find(&#123;&#125;).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中查询</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(res);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><ul><li>使用匹配条件查询数据  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要查询信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> selectdata = &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhongyuehui"</span> &#125; <span class="hljs-comment">//准备查询的信息</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).find(selectdata).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中查询</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(res);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><h3 id="更新一条数据"><a href="#更新一条数据" class="headerlink" title="更新一条数据"></a>更新一条数据</h3><ul><li>我们也可以对数据库的数据进行修改，使用<code>updateOne()</code>以下实例将<code>name</code>为<code>&quot;zhongyuehui</code>的<code>age</code>改为<code>22</code>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要查询信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> updateWhere = &#123; <span class="hljs-string">"naem"</span>: <span class="hljs-string">"zhongyuehui"</span> &#125;  <span class="hljs-comment">//更新的条件</span></span><br><span class="line">    <span class="hljs-keyword">var</span> UpdateData = &#123; $<span class="hljs-attribute">set</span>: &#123; <span class="hljs-string">"age"</span>: <span class="hljs-number">22</span> &#125; &#125;</span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).updateOne(updateWhere, UpdateData, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中查询</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据更新成功"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="更新多条数据"><a href="#更新多条数据" class="headerlink" title="更新多条数据"></a>更新多条数据</h3><ul><li><p>使用<code>updateMany()</code>，将<code>name</code>为<code>zhangsan</code>的<code>age</code>全部更改为<code>30</code></p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要查询信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> updateWhere = &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span> &#125;  <span class="hljs-comment">//更新的条件</span></span><br><span class="line">    <span class="hljs-keyword">var</span> UpdateData = &#123; $<span class="hljs-attribute">set</span>: &#123; <span class="hljs-string">"age"</span>: <span class="hljs-number">23</span> &#125; &#125;</span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).updateMany(updateWhere, UpdateData, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中查询</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据更新成功,更新了"</span> + res.result.nModified + <span class="hljs-string">"条数据"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>由于我插入了两条数据为’zhansan’所以结果如下</p>  <figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\M</span>r zhong<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\N</span>odejs<span class="hljs-symbol">\N</span>odejs-MongoDb&gt;node insertdata.js</span><br><span class="line">数据更新成功,更新了2条数据</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><h4 id="删除一条数据"><a href="#删除一条数据" class="headerlink" title="删除一条数据"></a>删除一条数据</h4><ul><li><p>使用<code>deleteOne()</code>删除一条数据,我们删除<code>name</code>为<code>&quot;zhangsan&quot;</code>的数据，就算此时有两条数据为<code>zhangsan</code>，他只会删除一条</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要删除信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> deleteWhere = &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span> &#125;  <span class="hljs-comment">//删除的条件</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).deleteOne(deleteWhere, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中删除</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据删除成功"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>查看数据表中的信息,只剩下一条<code>name</code>为<code>&quot;zhangsan&quot;</code></p>  <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.students.<span class="hljs-builtin-name">find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"看</span></span><br><span class="line"><span class="hljs-string">电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span> ] &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"wangmazi"</span>, <span class="hljs-string">"age"</span> : 15, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"打牌"</span>, <span class="hljs-string">"看电视"</span>, <span class="hljs-string">"看书"</span> ] &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44fc033805a3045ceb41bb"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"age"</span> : 23 &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除多条数据"><a href="#删除多条数据" class="headerlink" title="删除多条数据"></a>删除多条数据</h3><ul><li><p>使用<code>deleteMany()</code>删除多条数据,我们删除<code>name</code>为<code>&quot;zhangsan&quot;</code>的数据，我已经准备好两条name为zhangsan的数据</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>) <span class="hljs-comment">//要删除信息的数据库</span></span><br><span class="line">    <span class="hljs-keyword">var</span> deleteWhere = &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"zhangsan"</span> &#125;  <span class="hljs-comment">//删除的条件</span></span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).deleteMany(deleteWhere, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123; <span class="hljs-comment">//从student数据库的students表中删除</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"数据删除成功"</span>);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>这个时候我们再查看结果，都已经删除完毕</p>  <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.students.<span class="hljs-builtin-name">find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhongyuehui"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"看</span></span><br><span class="line"><span class="hljs-string">电影"</span>, <span class="hljs-string">"听音乐"</span>, <span class="hljs-string">"敲代码"</span> ] &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d44f690ac657d32f06318cf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"wangmazi"</span>, <span class="hljs-string">"age"</span> : 15, <span class="hljs-string">"hobby"</span> : [ <span class="hljs-string">"打牌"</span>, <span class="hljs-string">"看电视"</span>, <span class="hljs-string">"看书"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><ul><li><p>排序 使用 sort() 方法，该方法接受一个参数，规定是升序(1)还是降序(-1)。</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"> <span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"> </span><br><span class="line"> MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">     <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">     <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>)</span><br><span class="line">     <span class="hljs-keyword">var</span> mysort = &#123; <span class="hljs-string">"age"</span>: <span class="hljs-number">-1</span> &#125;  <span class="hljs-comment">//按照age进行降序</span></span><br><span class="line">     dbase.collection(<span class="hljs-string">"students"</span>).find().sort(mysort).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123;</span><br><span class="line">         <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">         <span class="hljs-built_in">console</span>.log(res);</span><br><span class="line">         db.close()</span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></li><li><p>注意：一般地我们排序时使用数字进行排序</p><h3 id="查询分页"><a href="#查询分页" class="headerlink" title="查询分页"></a>查询分页</h3></li><li><p>如果要设置指定的返回条数可以使用 limit() 方法，该方法只接受一个参数，指定了返回的条数。</p></li><li><p>我们需要读取两条数据</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>)</span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).find().limit(<span class="hljs-number">2</span>).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(res);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>如果要指定跳过的条数，可以使用<code>skip()</code>方法。比如我们跳过第一条取第二条</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;  <span class="hljs-comment">//调用mongodb模块</span></span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://localhost:27017/"</span>;  <span class="hljs-comment">//使用数据库地址和端口号以及数据库名</span></span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123; <span class="hljs-comment">//连数据库</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;  <span class="hljs-comment">//如果错误 抛出错误</span></span><br><span class="line">    <span class="hljs-keyword">var</span> dbase = db.db(<span class="hljs-string">'student'</span>)</span><br><span class="line">    dbase.collection(<span class="hljs-string">"students"</span>).find().skip(<span class="hljs-number">1</span>).limit(<span class="hljs-number">1</span>).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(res);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>如果我们需要分页查询，让<code>skip((页数-1)*每页的条数).limit(每页的条数)</code>就可以了</p><h3 id="连接操作"><a href="#连接操作" class="headerlink" title="连接操作"></a>连接操作</h3></li><li><p>mongoDB 不是一个关系型数据库，但我们可以使用<code>$lookup</code>来实现左连接,就是相当于MySQL中的多表连接</p></li><li><p>例如我们新建一个数据表(集合)<code>orders</code>添加以下信息</p>  <figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123; <span class="hljs-string">_id:</span> <span class="hljs-number">1</span>, <span class="hljs-string">product_id:</span> <span class="hljs-number">154</span>, <span class="hljs-string">status:</span> <span class="hljs-number">1</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>再建立一个数据表<code>products</code>添加以下信息</p>  <figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; <span class="hljs-string">_id:</span> <span class="hljs-number">154</span>, <span class="hljs-string">name:</span> <span class="hljs-string">'笔记本电脑'</span> &#125;,</span><br><span class="line">  &#123; <span class="hljs-string">_id:</span> <span class="hljs-number">155</span>, <span class="hljs-string">name:</span> <span class="hljs-string">'耳机'</span> &#125;,</span><br><span class="line">  &#123; <span class="hljs-string">_id:</span> <span class="hljs-number">156</span>, <span class="hljs-string">name:</span> <span class="hljs-string">'台式电脑'</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>实现左连接</p>  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://127.0.0.1:27017/"</span>;</span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;</span><br><span class="line">    <span class="hljs-keyword">var</span> dbo = db.db(<span class="hljs-string">"student"</span>);</span><br><span class="line">    dbo.collection(<span class="hljs-string">'orders'</span>).aggregate([</span><br><span class="line">        &#123;</span><br><span class="line">            $<span class="hljs-attribute">lookup</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-attribute">from</span>: <span class="hljs-string">'products'</span>,            <span class="hljs-comment">// 右集合</span></span><br><span class="line">                <span class="hljs-attribute">localField</span>: <span class="hljs-string">'product_id'</span>,    <span class="hljs-comment">// 左集合 join 字段</span></span><br><span class="line">                <span class="hljs-attribute">foreignField</span>: <span class="hljs-string">'_id'</span>,         <span class="hljs-comment">// 右集合 join 字段</span></span><br><span class="line">                <span class="hljs-attribute">as</span>: <span class="hljs-string">'orderdetails'</span>           <span class="hljs-comment">// 新生成字段（类型array）</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]).toArray(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(res));</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>结果：</p>  <figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="hljs-attr">"_id"</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">"product_id"</span>:<span class="hljs-number">154</span>,<span class="hljs-attr">"status"</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">"orderdetails"</span>:[&#123;<span class="hljs-attr">"_id"</span>:<span class="hljs-number">154</span>,<span class="hljs-attr">"name"</span>:<span class="hljs-string">"笔记本电脑"</span>&#125;]&#125;]</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><ul><li>使用<code>drop()</code>删除集合  <figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-string">"mongodb://127.0.0.1:27017/"</span>;</span><br><span class="line"></span><br><span class="line">MongoClient.connect(<span class="hljs-built_in">url</span>, &#123; <span class="hljs-attribute">useNewUrlParser</span>: <span class="hljs-literal">true</span> &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, db</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;</span><br><span class="line">    <span class="hljs-keyword">var</span> dbo = db.db(<span class="hljs-string">"User"</span>);</span><br><span class="line">    dbo.collection(<span class="hljs-string">'info'</span>).drop(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, delOK</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(delOK);</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用原生的Ndeojs来操作数据库进行增删改查&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Cookie的基本使用与Cookie二级域名之间的共享、Cookie的加密</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Cookie%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8ECookie%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B1%E4%BA%AB%E3%80%81Cookie%E7%9A%84%E5%8A%A0%E5%AF%86/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Cookie的基本使用与Cookie二级域名之间的共享、Cookie的加密/</id>
    <published>2019-08-04T10:31:02.000Z</published>
    <updated>2019-08-04T10:32:09.406Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>cookie是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名时共享数据</p></blockquote><a id="more"></a><h2 id="Cookie的基本使用"><a href="#Cookie的基本使用" class="headerlink" title="Cookie的基本使用"></a>Cookie的基本使用</h2><h3 id="认识cookie"><a href="#认识cookie" class="headerlink" title="认识cookie"></a>认识cookie</h3><ul><li><p>cookie是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名时共享数据。</p></li><li><p>HTTP 是无状态协议。简单地说，当你浏览了一个页面，然后转到同一个网站的另一个页面，服务器无法认识到这是同一个浏览器在访问同一个网站。每一次的访问，都是没有任何 关系的。 </p><ul><li>Cookie 是一个简单到爆的想法：当访问一个页面的时候，服务器在下行 HTTP 报文中， 命令浏览器存储一个字符串; 浏览器再访问同一个域的时候，将把这个字符串携带到上行 HTTP 请求中。第一次访问一个服务器，不可能携带 cookie。 必须是服务器得到这次请求， 在下行响应报头中，携带 cookie 信息，此后每一次浏览器往这个服务器发出的请求，都会 携带这个 cookie。 <h3 id="Cookie-特点"><a href="#Cookie-特点" class="headerlink" title="Cookie 特点"></a>Cookie 特点</h3></li></ul></li><li><p>cookie 保存在浏览器本地 </p></li><li><p>正常设置的 cookie 是不加密的，用户可以自由看到; </p></li><li><p>用户可以删除 cookie，或者禁用它 </p></li><li><p>cookie 可以被篡改 </p></li><li><p>cookie 可以用于攻击 </p></li><li><p>cookie 存储量很小。未来实际上要被 localStorage 替代，但是后者 IE9 兼容</p><h3 id="cookie的用途"><a href="#cookie的用途" class="headerlink" title="cookie的用途"></a>cookie的用途</h3></li><li><p>用来保存用户登陆状态</p></li><li><p>用来获取商品浏览信息，进行相似商品的推送</p></li><li><p>用来保存浏览的历史记录</p><h3 id="cookie的使用"><a href="#cookie的使用" class="headerlink" title="cookie的使用"></a>cookie的使用</h3></li><li><p>安装:<code>cnpm i cookie-parser --save</code></p></li><li><p>因为cookie也是一个中间件</p>  <figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-keyword">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">var</span> app = express()</span><br><span class="line">app.<span class="hljs-keyword">use</span>(cookieParser())</span><br></pre></td></tr></table></figure></li><li><p>实例</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookie())</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//读取cookie的值</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.signedCookies)</span><br><span class="line">    res.send(<span class="hljs-string">'Hello Nodejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setcookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//设置cookie</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    参数一:'cookie的名字'</span></span><br><span class="line"><span class="hljs-comment">    参数二：cookie的值</span></span><br><span class="line"><span class="hljs-comment">    参数三：cookie的配置信息</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    res.cookie(<span class="hljs-string">'userinfo'</span>, <span class="hljs-string">"zs"</span>, &#123; maxAge: <span class="hljs-number">60000</span> &#125;) <span class="hljs-comment">//表示6000毫秒后过期</span></span><br><span class="line">    <span class="hljs-comment">//这个时候cookie的值时这样的[&#123;userinfo:'zs&#125;]，如果需要设置多个cookie值，那么就需要多次使用res.cookie</span></span><br><span class="line">    res.send(<span class="hljs-string">'设置cookie完成'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul><h2 id="cookie的一些属性说明"><a href="#cookie的一些属性说明" class="headerlink" title="cookie的一些属性说明"></a><strong>cookie的一些属性说明</strong></h2><ul><li><p><code>domain</code>: 域名     </p></li><li><p><code>name=value</code>：键值对，可以设置要保存的 Key/Value，注意这里的 name 不能和其他属性项的名字 一样 </p></li><li><p><code>Expires</code>： 过期时间（秒），在设置的某个时间点后该 Cookie 就会失效，如 expires=Wednesday,<br>09-Nov-99 23:12:40 GMT     </p></li><li><p><code>maxAge</code>： 最大失效时间（毫秒），设置在多少后失效   -   secure： 当 secure 值为 true 时，cookie 在 HTTP 中是无效，在 HTTPS 中才有效     </p></li><li><p><code>Path</code>： 表示 cookie 影响到的路由，如 path=/。如果路径不能匹配时，浏览器则不发送这个 Cookie  </p></li><li><p><code>httpOnly</code>：是微软对 COOKIE 做的扩展。如果在 COOKIE 中设置了“httpOnly”属性，则通过程序（JS 脚本、applet 等）将无法读取到COOKIE 信息，防止 XSS 攻击产生 singed：表示是否签名cookie, 设为true 会对这个 cookie 签名，这样就需要用 res.signedCookies 而不是 res.cookies 访问它。被篡改的签名 cookie 会被服务器拒绝，并且 cookie 值会重置为它的原始值</p><h3 id="Cookie多个二级域名之间的共享"><a href="#Cookie多个二级域名之间的共享" class="headerlink" title="Cookie多个二级域名之间的共享"></a>Cookie多个二级域名之间的共享</h3></li><li><p>在一般的网站中，难免会有二级域名，如果需要在二级域名中使用一级域名的Cookie数据，那么就需要在设置cookie的时候加入一些参数</p></li><li><p>比如我们在hosts文件下添加以下域名解析</p>  <figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>  <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.hello</span><span class="hljs-selector-class">.com</span></span><br><span class="line">127<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>  <span class="hljs-selector-tag">news</span><span class="hljs-selector-class">.hello</span><span class="hljs-selector-class">.com</span></span><br></pre></td></tr></table></figure></li><li><p>这是时候news.hello.com就是二级域名，我们如果需要在二级域名也使用cookie。就需要如下添加<code>domain</code></p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookie())</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//读取cookie的值</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.signedCookies)</span><br><span class="line">    res.send(<span class="hljs-string">'Hello Nodejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setcookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//设置cookie</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    参数一:'cookie的名字'</span></span><br><span class="line"><span class="hljs-comment">    参数二：cookie的值</span></span><br><span class="line"><span class="hljs-comment">    参数三：cookie的配置信息</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    <span class="hljs-comment">//    -domain表示主域名 设置后我们可以在  xxx.hello.com中使用cookie的值</span></span><br><span class="line">    res.cookie(<span class="hljs-string">'userinfo'</span>, <span class="hljs-string">"zs"</span>, &#123; maxAge: <span class="hljs-number">60000</span>, domain: <span class="hljs-string">".hello.com"</span> &#125;) <span class="hljs-comment">//表示60000毫秒后过期</span></span><br><span class="line">    <span class="hljs-comment">//这个时候cookie的值时这样的[&#123;userinfo:'zs&#125;]</span></span><br><span class="line">    res.send(<span class="hljs-string">'设置cookie完成'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="设置cookie使用路径"><a href="#设置cookie使用路径" class="headerlink" title="设置cookie使用路径"></a><strong>设置cookie</strong>使用路径</h3><ul><li>有时候我们并不希望所有的页面都可以访问到cookie那么我们可以设置指定的路由地址才能访问到cookie，使用<code>path</code>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookie())</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//读取cookie的值</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.signedCookies)</span><br><span class="line">    res.send(<span class="hljs-string">'Hello Nodejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    res.send(<span class="hljs-string">'news '</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setcookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//设置cookie</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    参数一:'cookie的名字'</span></span><br><span class="line"><span class="hljs-comment">    参数二：cookie的值</span></span><br><span class="line"><span class="hljs-comment">    参数三：cookie的配置信息</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    <span class="hljs-comment">//path表示需要访问cookie的路由，这个时候只有/news才能访问cookie</span></span><br><span class="line">    res.cookie(<span class="hljs-string">'userinfo'</span>, <span class="hljs-string">"zs"</span>, &#123; maxAge: <span class="hljs-number">60000</span>, path: <span class="hljs-string">'/news'</span> &#125;)</span><br><span class="line">    <span class="hljs-comment">//这个时候cookie的值时这样的[&#123;userinfo:'zs&#125;]</span></span><br><span class="line">    res.send(<span class="hljs-string">'设置cookie完成'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="设置cookie的访问权限"><a href="#设置cookie的访问权限" class="headerlink" title="设置cookie的访问权限"></a>设置cookie的访问权限</h3><ul><li>在cookie中添加<code>httpOnly</code>可以使得只能在服务端访问cookie，在js中是不能访问得，增加了安全性  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookie())</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//读取cookie的值</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.signedCookies)</span><br><span class="line">    res.send(<span class="hljs-string">'Hello Nodejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    res.send(<span class="hljs-string">'news '</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setcookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//设置cookie</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    参数一:'cookie的名字'</span></span><br><span class="line"><span class="hljs-comment">    参数二：cookie的值</span></span><br><span class="line"><span class="hljs-comment">    参数三：cookie的配置信息</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    <span class="hljs-comment">//path表示需要访问cookie的路由，这个时候只有/news才能访问cookie,并且只有在服务端才能使用cookie</span></span><br><span class="line">    res.cookie(<span class="hljs-string">'userinfo'</span>, <span class="hljs-string">"zs"</span>, &#123; maxAge: <span class="hljs-number">60000</span>, path: <span class="hljs-string">'/news'</span>, httpOnly: <span class="hljs-literal">true</span> &#125;)</span><br><span class="line">    <span class="hljs-comment">//这个时候cookie的值时这样的[&#123;userinfo:'zs&#125;]</span></span><br><span class="line">    res.send(<span class="hljs-string">'设置cookie完成'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="cookie的加密"><a href="#cookie的加密" class="headerlink" title="cookie的加密"></a>cookie的加密</h3><ul><li>使用<code>singed</code>属性加密，获取加密cookie需要使用<code>res.singedCookie</code>而不是<code>re.cookie</code>，需要配置中间件，不然不能起作用  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookie(<span class="hljs-string">'a12a'</span>)) <span class="hljs-comment">//配置加密，可以是任意字符串</span></span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.signedCookies) <span class="hljs-comment">//读取加密的cookie</span></span><br><span class="line">    res.send(<span class="hljs-string">'Hello Nodejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.cookies);</span><br><span class="line">    res.send(<span class="hljs-string">'news '</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="hljs-string">'/setcookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//设置cookie</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    参数一:'cookie的名字'</span></span><br><span class="line"><span class="hljs-comment">    参数二：cookie的值</span></span><br><span class="line"><span class="hljs-comment">    参数三：cookie的配置信息</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    res.cookie(<span class="hljs-string">'userinfo'</span>, <span class="hljs-string">"zs"</span>, &#123; maxAge: <span class="hljs-number">60000</span>, signed: <span class="hljs-literal">true</span> &#125;) <span class="hljs-comment">//表示需要加密，这个加密是在浏览器显示的时候加密</span></span><br><span class="line">    <span class="hljs-comment">//这个时候cookie的值时这样的[&#123;userinfo:'zs&#125;]</span></span><br><span class="line">    res.send(<span class="hljs-string">'设置cookie完成'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;cookie是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名时共享数据&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>Express中的中间件</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/express%E4%B8%AD%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/express中的中间件/</id>
    <published>2019-08-04T10:30:57.000Z</published>
    <updated>2019-08-04T10:30:40.493Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在Nodejs中的Express框架来说，中间件是一个比较抽象的概念，但是对于理解Nodejs的请求原理是非常重要的，这里简单的介绍了Nodejs中Express框架的中间件原理</p></blockquote><a id="more"></a><!-- toc --><hr><h2 id="中间件的原理"><a href="#中间件的原理" class="headerlink" title="中间件的原理"></a>中间件的原理</h2><hr><p><img src="https://i.loli.net/2019/06/24/5d1044327363a92295.png" alt></p><ul><li><p>就是相当于水经过一系列处理到用户的过程，中间不能跳过某些步骤或者调换某些步骤</p><h2 id="Express中间件"><a href="#Express中间件" class="headerlink" title="Express中间件"></a>Express中间件</h2></li><li><p>Express是一个自身功能极简，完全是由路由和中间件构成的一个web开发框架，从本质来说，一个Express应用就是在调用各种中间件</p></li><li><p>中间件(Middlewaew)是一个函数，它可以访问请求对象(request object(req))，响应对象(response(res))和web应用中处理数据请求-响应循环流程中的中间件，一般命名为next的变量</p></li><li><p><strong>中间件的功能:</strong></p><ul><li>执行任何代码</li><li>修改请求和响应对象</li><li>终结请求-响应循环</li><li>调用堆栈中的下一个中间件</li></ul></li><li><p>如果我的get、post回调函数中，没有next参数，那么匹配上第一个路由，就不会往下匹配，如果需要匹配，就需要写next()</p></li><li><p><strong>Express应用可使用如下几种中间件</strong></p><ul><li>应用级中间件</li><li>路由中间件<h3 id="应用级中间件"><a href="#应用级中间件" class="headerlink" title="应用级中间件"></a>应用级中间件</h3></li></ul></li><li><p>例如：我们需要在匹配路由前打印以下时间</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="hljs-string">'/public/'</span>, express.static(<span class="hljs-string">'./public'</span>))</span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"><span class="hljs-comment">/*中间件</span></span><br><span class="line"><span class="hljs-comment">    应用级中间件</span></span><br><span class="line"><span class="hljs-comment">    这里表示匹配任何路由</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>())  <span class="hljs-comment">//到这里时路由不会继续往下匹配，因为匹配成功了一个，如果需要继续匹配加入next()</span></span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<span class="hljs-comment">//同样的如果这里匹配成功了还需要继续往下匹配，那么这里也需要使用next()</span></span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>一般地应用级中间件用来做权限的判断，比如没有登陆不能访问某些页面，这个时候我们可以使用这个中间件进行处理</p><h3 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h3></li><li><p>路由中间件用来匹配路由规则，如果匹配成功做出对应的处理，但是如果没有next同样的路由，只能执行一次不会往下执行</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="hljs-string">'/public/'</span>, express.static(<span class="hljs-string">'./public'</span>))</span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//路由中间件</span></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'news'</span>);</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'news.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>当然，应用级中间件也可以匹配路由</p>  <figure class="highlight lua hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="hljs-string">'/news'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(req, res, next)</span></span> &#123;</span><br><span class="line">console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"use --news"</span>);</span><br><span class="line"><span class="hljs-built_in">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="配置错误处理中间件"><a href="#配置错误处理中间件" class="headerlink" title="配置错误处理中间件"></a>配置错误处理中间件</h3><ul><li><p>由于中间件和路由执行顺序都是从上往下的，如果以上路由都没有匹配成功，我们将应用级中间件放到最后面，这样前面的路由没有匹配成功就会进入这个中间件处理</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="hljs-string">'/public/'</span>, express.static(<span class="hljs-string">'./public'</span>))</span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'news.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置错误处理中间件</span></span><br><span class="line">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//status表示改变状态。200为请求成功，304为缓存，404为请求失败</span></span><br><span class="line">    res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">'Not Found 404'</span>)  <span class="hljs-comment">//当然，在这里也可以使用render一个错误页面</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>这个时候，我们除了请求/和/news，其他的路由都会进入404，因为前面无法匹配</p><h3 id="内置中间件"><a href="#内置中间件" class="headerlink" title="内置中间件"></a>内置中间件</h3></li><li><p>之前学习的<code>app.use(express.static(&#39;/public&#39;))</code>就是内置的一个中间件，用来托管静态公共资源的，因为我们使用<code>app.use(&#39;/static&#39;,express.static(&#39;/public&#39;))</code>用过/static/也能获取到public里面的资源</p><h3 id="使用body-parser第三方中间件"><a href="#使用body-parser第三方中间件" class="headerlink" title="使用body-parser第三方中间件"></a>使用body-parser第三方中间件</h3></li><li><p>因为express并没有提供<code>post</code>的方式，所以我们需要借助于第三方的中间件来进行<code>post</code>操作</p></li><li><p>最简单的使用方式，将通用JSON和URL编码的解析器添加为顶级中间件，它将解析所有传入请求的主体。这是最简单的设置。</p>  <figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-keyword">require</span>(<span class="hljs-string">'body-parser'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// parse application/x-www-form-urlencoded</span></span><br><span class="line">app.<span class="hljs-keyword">use</span>(bodyParser.urlencoded(&#123; extended: <span class="hljs-keyword">false</span> &#125;))</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// parse application/json</span></span><br><span class="line">app.<span class="hljs-keyword">use</span>(bodyParser.json())</span><br><span class="line">app.<span class="hljs-keyword">use</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(req, res)</span> </span>&#123;</span><br><span class="line">  res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/plain'</span>)</span><br><span class="line">  res.write(<span class="hljs-string">'you posted:\n'</span>)</span><br><span class="line">  res.end(JSON.stringify(req.body, <span class="hljs-keyword">null</span>, <span class="hljs-number">2</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>将如body解析器专门添加到需要它们的路由中。通常，这是在Express中使用body-parser的最佳方法。</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// create application/json parser</span></span><br><span class="line"><span class="hljs-keyword">var</span> jsonParser = bodyParser.json()</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// create application/x-www-form-urlencoded parser</span></span><br><span class="line"><span class="hljs-keyword">var</span> urlencodedParser = bodyParser.urlencoded(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// POST /login gets urlencoded bodies</span></span><br><span class="line">app.post(<span class="hljs-string">'/login'</span>, urlencodedParser, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="hljs-string">'welcome, '</span> + req.body.username)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// POST /api/users gets JSON bodies</span></span><br><span class="line">app.post(<span class="hljs-string">'/api/users'</span>, jsonParser, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-comment">// create user in req.body</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>所有解析器都接受一个类型选项，允许您更改中间件将解析的Content-Type</p>  <figure class="highlight lasso hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-built_in">var</span> bodyParser = <span class="hljs-keyword">require</span>(<span class="hljs-string">'body-parser'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="hljs-built_in">var</span> app = express()</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// parse various different custom JSON types as JSON</span></span><br><span class="line">app.use(bodyParser.json(&#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">'application/*+json'</span> &#125;))</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// parse some custom thing into a Buffer</span></span><br><span class="line">app.use(bodyParser.raw(&#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">'application/vnd.custom-type'</span> &#125;))</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// parse an HTML body into a string</span></span><br><span class="line">app.use(bodyParser.text(&#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">'text/html'</span> &#125;))</span><br></pre></td></tr></table></figure></li><li><p>使用body-parser中间件处理表单post请求，并使用<code>req.body</code>获取传递的值</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-comment">//引入body-parser</span></span><br><span class="line"><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置body-parser</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: <span class="hljs-literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// parse application/json</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="hljs-string">'/public/'</span>, express.static(<span class="hljs-string">'./public'</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置ejs模板</span></span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'news.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//配置表单数据路由</span></span><br><span class="line">app.get(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="hljs-string">'login.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//配置表单提交路由</span></span><br><span class="line">app.post(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(req.body)  <span class="hljs-comment">//使用req获取请求的数据，就是表单提交的数据</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//配置错误处理中间件</span></span><br><span class="line">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//status表示改变状态。200为请求成功，304为缓存，404为请求失败</span></span><br><span class="line">    res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">'Not Found 404'</span>)  <span class="hljs-comment">//当然，在这里也可以使用render一个错误页面</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p><code>login.ejs</code>页面</p>  <figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">""</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"username"</span>&gt;</span></span><br><span class="line">            用户名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"password"</span>&gt;</span></span><br><span class="line">            密 码: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在Nodejs中的Express框架来说，中间件是一个比较抽象的概念，但是对于理解Nodejs的请求原理是非常重要的，这里简单的介绍了Nodejs中Express框架的中间件原理&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>在Express使用ejs模板引擎以及静态文件的托管</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/%E5%9C%A8Express%E4%BD%BF%E7%94%A8ejs%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E4%BB%A5%E5%8F%8A%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%98%E7%AE%A1/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/在Express使用ejs模板引擎以及静态文件的托管/</id>
    <published>2019-08-04T10:26:28.000Z</published>
    <updated>2019-08-04T10:27:35.173Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ejs模板引擎在Express中有集成渲染的中间件,不需要配置即可使用.</p></blockquote><a id="more"></a><h2 id="在Express使用ejs模板引擎"><a href="#在Express使用ejs模板引擎" class="headerlink" title="在Express使用ejs模板引擎"></a>在Express使用ejs模板引擎</h2><ul><li><p>在之前我们使用ejs模板需要先安装，再引入，才能使用，但是在express中，安装后就可以直接使用</p></li><li><p>安装:<code>cnpm i ejs --save-dev</code></p></li><li><p>使用express的render渲染页面</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置模板引擎</span></span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//使用express的render渲染页面</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//这里使用render表示渲染哪个页面，默认从views中查找</span></span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>渲染页面并传值</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置模板引擎</span></span><br><span class="line">app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//使用express的render渲染页面</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">//这里使用render表示渲染哪个页面，默认从views中查找</span></span><br><span class="line">    res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">//使用express的render渲染页面并传递参数</span></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> list = [<span class="hljs-string">'number'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'boolean'</span>, <span class="hljs-string">'undefined'</span>, <span class="hljs-string">'null'</span>, <span class="hljs-string">'object'</span>]</span><br><span class="line">    res.render(<span class="hljs-string">'news.ejs'</span>, &#123;</span><br><span class="line">        list: list  <span class="hljs-comment">//可以简写成list</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>获取传递的值<code>news.ejs</code></p>  <figure class="highlight erb hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>news<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby"> <span class="hljs-keyword">for</span>(let i=<span class="hljs-number">0</span>;i&lt;list.length;i++)&#123;</span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="hljs-ruby">list[i] </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby"> &#125; </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>补充：</p><ul><li><p>在渲染页面的时候默认会在views中进行查找，如果需要改变默认视图页面的目录可以使用如下方式</p></li><li><p><code>app.set(&quot;views&quot;,__dirname + &quot;/设置的目录名称&quot;)</code></p></li><li><p>但是这种方式不被推荐，一般使用默认的目录</p></li><li><p>在使用ejs模板引擎的时候，如果你想使用html的文件后缀名，可以使用如下配置</p>  <figure class="highlight lasso hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//引入ejs</span></span><br><span class="line"><span class="hljs-built_in">var</span> ejs = <span class="hljs-keyword">require</span>(<span class="hljs-string">'ejs'</span>)</span><br><span class="line"><span class="hljs-comment">//配置ejs</span></span><br><span class="line">app.engine(<span class="hljs-string">'html'</span>, ejs.__express)</span><br><span class="line"><span class="hljs-comment">//配置模板引擎</span></span><br><span class="line">app.<span class="hljs-built_in">set</span>(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"html"</span>)</span><br></pre></td></tr></table></figure></li><li><p>但是一般我们不需要去修改</p><h3 id="静态文件的托管"><a href="#静态文件的托管" class="headerlink" title="静态文件的托管"></a>静态文件的托管</h3></li></ul></li><li><p>如果我们定义了一些页面的样式，样式被其他页面引入，这时候如果直接使用css样式会报错，因为路径不唯一，那么这个时候我们就需要使用静态资源的托管，在express中已经为我们提供了这项功能</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"> <span class="hljs-keyword">const</span> app = express()</span><br><span class="line"> <span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"> <span class="hljs-comment">//配置静态资源文件,第一个参数是使用的文件名，第二个参数的设置静态资源的文件夹</span></span><br><span class="line"> app.use(<span class="hljs-string">'/public/'</span>, express.static(<span class="hljs-string">'./public'</span>))</span><br><span class="line"> <span class="hljs-comment">// http://localhost:3000/public/css/style.css可以使用css文件,其中第一个参数中的这个public可以不写，</span></span><br><span class="line"> <span class="hljs-comment">//通过http://localhost:3000/css/style.cs来使用文件，也可以修改任意名，这个时候就形成了虚拟目录，只要使用的时候带上这个路由名即可</span></span><br><span class="line"> <span class="hljs-comment">// app.use(express.static('./public'))</span></span><br><span class="line"> </span><br><span class="line"> app.set(<span class="hljs-string">"View engine"</span>, <span class="hljs-string">"ejs"</span>)</span><br><span class="line"> app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">     res.render(<span class="hljs-string">'index.ejs'</span>)</span><br><span class="line"> &#125;)</span><br><span class="line"> app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>使用静态文件下的css样式文件,公共样式表哪里引入公共样式就在那里引入样式</p>  <figure class="highlight erb hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-comment">&lt;!-- 因为配置了静态web服务 我们只需要使用这个路径就可以使用public下的css文件夹下的文件 --&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/public/css/style.css"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-comment">&lt;!-- 引入公共样式 --&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby"><span class="hljs-keyword">include</span> ./header.ejs </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>你好ejs<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ejs模板引擎在Express中有集成渲染的中间件,不需要配置即可使用.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>Express框架的安装和基本使用</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Express%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Express框架的安装和基本使用/</id>
    <published>2019-08-04T10:24:42.000Z</published>
    <updated>2019-08-04T10:26:06.506Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Express框架是基于Nodejs的框架,非常简洁,但是功能非常强大.</p></blockquote><a id="more"></a><h2 id="Express框架的安装和基本使用"><a href="#Express框架的安装和基本使用" class="headerlink" title="Express框架的安装和基本使用"></a>Express框架的安装和基本使用</h2><ul><li><p>安装：<code>cnpm i express -save-dev</code></p></li><li><p>引入:<code>const express= require(&quot;express&quot;)</code></p></li><li><p>实例化:<code>const app =express()</code>,也可以使用<code>const app=new express()</code></p></li><li><p>使用</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置静态路由规则</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))  <span class="hljs-comment">//使用express的send方法</span></span><br><span class="line">app.get(<span class="hljs-string">'/news'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.end(<span class="hljs-string">'xixi'</span>))<span class="hljs-comment">//使用原生的end方法</span></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>配置动态路由</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置静态路由</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))  <span class="hljs-comment">//使用express的send方法</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置动态路由，传递id</span></span><br><span class="line">app.get(<span class="hljs-string">'/news/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'新闻'</span>))</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>获取动态路由的值,使用req.params可以获取传递的数据对象,req.params.属性名获取传递的值</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置静态路由</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))  <span class="hljs-comment">//使用express的send方法</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置动态路由，传递id</span></span><br><span class="line">app.get(<span class="hljs-string">'/news/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.params);  <span class="hljs-comment">//获取传递过来的数据&#123;&#125;</span></span><br><span class="line">    res.send(<span class="hljs-string">'新闻'</span> + req.params.id)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li><li><p>get传值与获取，使用<code>/news?id=5&amp;name=&quot;zs&quot;</code>这种形式传值</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> app = express()</span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//配置静态路由</span></span><br><span class="line">app.get(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.send(<span class="hljs-string">'Hello World!'</span>))  <span class="hljs-comment">//使用express的send方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//get传值</span></span><br><span class="line"><span class="hljs-comment">// http://localhost:3000/product?id=5&amp;name="zs"</span></span><br><span class="line">app.get(<span class="hljs-string">'/product'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(req.query);</span><br><span class="line">    res.send(<span class="hljs-string">'product'</span> + req.query.id + <span class="hljs-string">"------"</span> + req.query.name)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening on port port!`</span>))</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Express框架是基于Nodejs的框架,非常简洁,但是功能非常强大.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Express" scheme="https://zhongyuehui.github.io/tags/Express/"/>
    
  </entry>
  
  <entry>
    <title>Nodejs的ejs模板引擎的使用</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Nodejs%E7%9A%84ejs%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Nodejs的ejs模板引擎的使用/</id>
    <published>2019-08-04T10:21:43.000Z</published>
    <updated>2019-08-04T10:23:52.675Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ejs模板引擎和art-template引擎一样,都是快速渲染数据,减少代码工作量.</p></blockquote><a id="more"></a><h2 id="Nodejs的ejs模板引擎的使用"><a href="#Nodejs的ejs模板引擎的使用" class="headerlink" title="Nodejs的ejs模板引擎的使用"></a>Nodejs的<a href="https://ejs.bootcss.com" target="_blank" rel="noopener">ejs</a>模板引擎的使用</h2><ul><li><p>安装:<code>cnpm i ejs --save</code></p></li><li><p>标签：</p>  <figure class="highlight mel hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="hljs-string">'脚本'</span> 标签，用于流程控制，无输出。</span><br><span class="line">&lt;%_ 删除其前面的空格符</span><br><span class="line">&lt;%= 输出数据到模板（输出是转义 HTML 标签）</span><br><span class="line">&lt;%- 输出非转义的数据到模板</span><br><span class="line">&lt;%# 注释标签，不执行、不输出内容</span><br><span class="line">&lt;%% 输出字符串 <span class="hljs-string">'&lt;%'</span></span><br><span class="line">%&gt; 一般结束标签</span><br><span class="line">-%&gt; 删除紧随其后的换行符</span><br><span class="line">_%&gt; 将结束标签后面的空格符删除</span><br></pre></td></tr></table></figure></li><li><p>语法：</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//app.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> ejs =<span class="hljs-built_in">require</span>(<span class="hljs-string">'ejs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> port = <span class="hljs-number">8081</span></span><br><span class="line">http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//头文件</span></span><br><span class="line">    response.writeHead(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> &#125;);</span><br><span class="line">    <span class="hljs-comment">//过滤掉url中的参数</span></span><br><span class="line">    <span class="hljs-keyword">let</span> pathname = url.parse(request.url).pathname</span><br><span class="line">    <span class="hljs-keyword">if</span> (pathname == <span class="hljs-string">'/login'</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">//传递参数</span></span><br><span class="line">        <span class="hljs-keyword">let</span> data = <span class="hljs-string">'123'</span></span><br><span class="line">        <span class="hljs-comment">// 传递数组</span></span><br><span class="line">        <span class="hljs-keyword">let</span> list=[</span><br><span class="line">            <span class="hljs-string">'123'</span>,</span><br><span class="line">            <span class="hljs-string">'456'</span>,</span><br><span class="line">            <span class="hljs-string">'789'</span></span><br><span class="line">        ]</span><br><span class="line">        ejs.renderFile(<span class="hljs-string">'views/login.html'</span>,&#123;<span class="hljs-built_in">number</span>:data,list&#125;,<span class="hljs-function">(<span class="hljs-params">error,data</span>)=&gt;</span>&#123;</span><br><span class="line">        response.end(data);            </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pathname == <span class="hljs-string">'/resgin'</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">//使用模板引擎的方法读取数据并渲染</span></span><br><span class="line">        <span class="hljs-keyword">let</span> html=<span class="hljs-string">'&lt;h2&gt;这是注册页面&lt;/h2&gt;'</span></span><br><span class="line">        ejs.renderFile(<span class="hljs-string">'views/resgin.html'</span>,&#123;html&#125;,<span class="hljs-function">(<span class="hljs-params">error,data</span>)=&gt;</span>&#123;</span><br><span class="line">            response.end(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(port, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'run'</span> + port)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>login.html</p>  <figure class="highlight django hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=number%</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">for</span>(<span class="hljs-attr">let</span> <span class="hljs-attr">i</span>= <span class="hljs-string">0;i</span>&lt;<span class="hljs-attr">list.length</span>;<span class="hljs-attr">i</span>++) &#123; %&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=list[i]</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>resgin.html</p>  <figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>resgin<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">html</span>%&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>上述代码中实现了一些简单的语法使用方式</p><h3 id="公共部分"><a href="#公共部分" class="headerlink" title="公共部分"></a>公共部分</h3></li><li><p>使用ejs模板引擎引入公共头部或者尾部，在index.ejs中引入<code>header.ejs</code></p>  <figure class="highlight erb hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span></span></span><span class="hljs-ruby"><span class="hljs-keyword">include</span> ../public/header.ejs </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span></span></span><br></pre></td></tr></table></figure></li></ul><h4 id="ejs循环语句"><a href="#ejs循环语句" class="headerlink" title="ejs循环语句"></a>ejs循环语句</h4><pre><code><figure class="highlight erb hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby"> <span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)&#123; </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span> </span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> </span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby">&#125; <span class="hljs-keyword">else</span>&#123; </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span> </span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> </span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="hljs-ruby">&#125; </span><span class="hljs-xml"><span class="hljs-tag">%&gt;</span></span></span><br></pre></td></tr></table></figure></code></pre>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ejs模板引擎和art-template引擎一样,都是快速渲染数据,减少代码工作量.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="https://zhongyuehui.github.io/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>使用JS对数据表进行批量插入和vscode工具</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/%E4%BD%BF%E7%94%A8JS%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E5%92%8Cvscode%E5%B7%A5%E5%85%B7/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/使用JS对数据表进行批量插入和vscode工具/</id>
    <published>2019-08-04T10:20:04.000Z</published>
    <updated>2019-08-04T10:21:07.531Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我们可以在js文件中对数据库进行批量操作,更方便.</p></blockquote><a id="more"></a><h2 id="使用JS对数据表进行批量插入"><a href="#使用JS对数据表进行批量插入" class="headerlink" title="使用JS对数据表进行批量插入"></a>使用JS对数据表进行批量插入</h2><ul><li><p>使用循环插入数据</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime()</span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)  <span class="hljs-comment">//连接数据库</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;</span><br><span class="line">    db.user.insert(&#123; <span class="hljs-string">"num"</span>: <span class="hljs-number">1</span> &#125;)  <span class="hljs-comment">//往数据表循环添加数据</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> runTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(runTime + <span class="hljs-string">'ms'</span>)  <span class="hljs-comment">//604ms</span></span><br></pre></td></tr></table></figure></li><li><p>使用批量插入</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime()</span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)  <span class="hljs-comment">//连接数据库</span></span><br><span class="line"><span class="hljs-keyword">var</span> dataArray = []</span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;</span><br><span class="line">    dataArray.push(&#123; <span class="hljs-string">"num"</span>: <span class="hljs-number">1</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">db.user.insert(dataArray)  <span class="hljs-comment">//批量操作</span></span><br><span class="line"><span class="hljs-keyword">var</span> runTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(runTime + <span class="hljs-string">'ms'</span>)  <span class="hljs-comment">//34ms</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h2><ul><li>使用批量操作对数据表进行数据的插入比循环插入性能快了几十倍</li><li>尽量使用批量插入<h3 id="vsode操作mongodb"><a href="#vsode操作mongodb" class="headerlink" title="vsode操作mongodb"></a>vsode操作mongodb</h3></li><li>在vscode中，我们打开了数据库服务之后，可以直接在终端调试工具执行这个mongo</li><li>我们在js文件中写好了要插入的数据后，我们可以在终端使用 <code>mongo js文件名</code>,这样自动会执行我们的js代码进行数据库的操作</li><li>或者使用mongo后进入数据库界面使用<code>load(&#39;./文件名的方式&#39;)</code>，但是这个前提是要终端的路径打开在文件的路径中，而且需要<code>use</code>了当前数据表的数据库，可以不要连接数据库直接插入数据或者查找数据</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;我们可以在js文件中对数据库进行批量操作,更方便.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB数据库的备份与还原</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/MongoDB数据库的备份与还原/</id>
    <published>2019-08-04T10:18:28.000Z</published>
    <updated>2019-08-04T10:19:25.906Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>数据库的备份与还原也是在操作数据库中常用的操作,但是它们非常简单.</p></blockquote><a id="more"></a><h2 id="MongoDB数据库的备份与还原"><a href="#MongoDB数据库的备份与还原" class="headerlink" title="MongoDB数据库的备份与还原"></a>MongoDB数据库的备份与还原</h2><h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><ul><li><p>备份格式：</p>  <figure class="highlight jboss-cli hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mongodump</span><br><span class="line"><span class="hljs-params">--host</span> 127.0.0.1  <span class="hljs-string">//</span>主机名</span><br><span class="line"><span class="hljs-params">--port</span> 27017  。。端口号</span><br><span class="line"><span class="hljs-params">--out</span> D:<span class="hljs-string">/databack/backup</span>  <span class="hljs-string">//</span>备份路径</span><br><span class="line"><span class="hljs-params">--collection</span> myCollections  <span class="hljs-string">//</span>备份的数据表</span><br><span class="line"><span class="hljs-params">--db</span> test  <span class="hljs-string">//</span>备份的数据库</span><br><span class="line"><span class="hljs-params">--username</span> username  <span class="hljs-string">//</span>用户名</span><br><span class="line"><span class="hljs-params">--password</span> password  <span class="hljs-string">//</span>密码</span><br></pre></td></tr></table></figure></li><li><p>mongodump命令脚本语法如下</p>  <figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&gt;</span><span class="hljs-bash">mongodump -h dbhost -d dbname -o dbdirectory</span></span><br></pre></td></tr></table></figure></li><li><p>-h： MongDB所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</p></li><li><p>-d：需要备份的数据库实例，例如：test</p></li><li><p>-o：备份的数据存放位置，例如：c:\data\dump，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个test目录，这个目录里面存放该数据库实例的备份数据。</p><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4></li><li><p>备份格式中，后面那些参数都是可选的</p></li><li><p>如果我们不指定数据表和数据库，那么默认全部都会备份,但是备份时我们不用进入数据库，直接在命令行进行备份</p>  <figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\S</span>erver<span class="hljs-symbol">\4</span>.0<span class="hljs-symbol">\b</span>in&gt; mongodump --host 127.0.0.1:27017 --out E:<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\d</span>ata</span><br></pre></td></tr></table></figure></li><li><p>也可以简写成这样</p>  <figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\M</span>ongoDB<span class="hljs-symbol">\S</span>erver<span class="hljs-symbol">\4</span>.0<span class="hljs-symbol">\b</span>in&gt; mongodump -h 127.0.0.1:27017 -o E:<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\h</span>ome</span><br></pre></td></tr></table></figure></li></ul><h3 id="恢复还原"><a href="#恢复还原" class="headerlink" title="恢复还原"></a>恢复还原</h3><ul><li><p>mongodb使用 mongorerstore 命令来恢复备份的数据。</p><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4></li><li><p>mongorestore命令脚本语法如下：</p>  <figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mongorestore -h dbhost -d dbname <span class="hljs-comment">--directoryperdb dbdirectory</span></span><br></pre></td></tr></table></figure></li><li><p>-h：MongoDB所在服务器地址</p></li><li><p>-d：需要恢复的数据库实例，例如：test，当然这个名称也可以和备份时候的不一样，比如test2</p></li><li><p>–directoryperdb：<br>备份数据所在位置，例如：c:\data\dump\test，这里为什么要多加一个test，而不是备份时候的dump，读者自己查看提示吧！</p></li><li><p>–drop:恢复的时候，先删除当前数据，然后恢复备份的数据。就是说，恢复后，备份后添加修改的数据都会被删除，慎用哦！</p></li><li><p>基本格式</p>  <figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongorestore</span><br><span class="line"><span class="hljs-comment">--host 127.0.0.1</span></span><br><span class="line"><span class="hljs-comment">--port 27017</span></span><br><span class="line"><span class="hljs-comment">--username username</span></span><br><span class="line"><span class="hljs-comment">--password password</span></span><br><span class="line">&lt;path <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> backup&gt;</span><br></pre></td></tr></table></figure></li><li><p>比如我们现在不小心删除了一个collections的数据，要进行恢复。现在删除random集合</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.drop</span>()</span><br></pre></td></tr></table></figure></li><li><p>使用命令进行恢复</p>  <figure class="highlight jboss-cli hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongorestore <span class="hljs-params">--host</span> 127.0.0.1 <span class="hljs-params">--port</span> 27017 E:<span class="hljs-string">/data/data</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;数据库的备份与还原也是在操作数据库中常用的操作,但是它们非常简单.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB用户的创建删除和管理</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/MongoDB%E7%94%A8%E6%88%B7%E7%9A%84%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E5%92%8C%E7%AE%A1%E7%90%86/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/MongoDB用户的创建删除和管理/</id>
    <published>2019-08-04T10:16:19.000Z</published>
    <updated>2019-08-04T10:17:45.893Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一般的在一些项目上,我们都是通过用户来登陆数据库和访问数据库的,这样可以更好的管理用户的权限.</p></blockquote><a id="more"></a><h2 id="用户的创建删除和管理"><a href="#用户的创建删除和管理" class="headerlink" title="用户的创建删除和管理"></a>用户的创建删除和管理</h2><ul><li><p>创建用户,在admim数据库中创建user数据表，在该表中添加用户数据和权限</p>  <figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">use admin后</span><br><span class="line"></span><br><span class="line">db.createUser(&#123;<span class="hljs-comment">// 创建user表</span></span><br><span class="line"><span class="hljs-string">user:</span> <span class="hljs-string">"zhong"</span>,   <span class="hljs-comment">//用户名称</span></span><br><span class="line"><span class="hljs-string">pwd:</span> <span class="hljs-string">"123456"</span>, <span class="hljs-comment">//用户密码</span></span><br><span class="line"><span class="hljs-string">customData:</span> &#123;  <span class="hljs-comment">//数据</span></span><br><span class="line"><span class="hljs-symbol">    name:</span> <span class="hljs-string">'Mrzhong'</span>, <span class="hljs-comment">//用户名</span></span><br><span class="line"><span class="hljs-symbol">    email:</span> <span class="hljs-string">'web0432@126.com'</span>, <span class="hljs-comment">//邮箱</span></span><br><span class="line"><span class="hljs-symbol">    age:</span> <span class="hljs-number">18</span>,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="hljs-string">roles:</span> [&#123;  <span class="hljs-comment">//权限模块</span></span><br><span class="line"><span class="hljs-symbol">    role:</span> <span class="hljs-string">"readWrite"</span>,  <span class="hljs-comment">// 具体权限</span></span><br><span class="line"><span class="hljs-symbol">    db:</span> <span class="hljs-string">"User"</span>  <span class="hljs-comment">//赋予该权限的数据库</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="hljs-string">'read'</span>  <span class="hljs-comment">//其他数据库</span></span><br><span class="line">]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>用户权限的说明：</p><table><thead><tr><th>权限</th><th align="center">说明</th></tr></thead><tbody><tr><td>Read</td><td align="center">允许用户读取指定数据库</td></tr><tr><td>readWrite</td><td align="center">允许用户读写指定数据库</td></tr><tr><td>dbAdmin</td><td align="center">允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</td></tr><tr><td>userAdmin</td><td align="center">允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</td></tr><tr><td>clusterAdmin</td><td align="center">只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</td></tr><tr><td>readAnyDatabase</td><td align="center">只在admin数据库中可用，赋予用户所有数据库的读权限</td></tr><tr><td>readWriteAnyDatabase</td><td align="center">只在admin数据库中可用，赋予用户所有数据库的读写权限</td></tr><tr><td>userAdminAnyDatabase</td><td align="center">只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</td></tr><tr><td>dbAdminAnyDatabase</td><td align="center">只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</td></tr><tr><td>root</td><td align="center">只在admin数据库中可用。超级账号，超级权限</td></tr></tbody></table></li></ul><h3 id="删除用户数据"><a href="#删除用户数据" class="headerlink" title="删除用户数据"></a>删除用户数据</h3><ul><li><p>使用<code>db.system.users.remove({要删除的用户信息条件})</code>一般是以用户名为条件</p><h3 id="建权"><a href="#建权" class="headerlink" title="建权"></a>建权</h3></li><li><p>有时候我们要验证用户的用户名密码是否正确，就需要用到MongoDB提供的健全操作。也算是一种登录操作，不过MongoDB把这叫做建权。</p></li><li><p>建权就是给之前的数据表注册给功能一样，登陆了建权的用户可以和创建用户时的权限做匹配，就是你创建用户的时候允许的权限，建权之后就可以获得权限</p></li><li><p>如何建权呢？</p>  <figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.auth</span>(<span class="hljs-string">"zhong"</span>,<span class="hljs-string">"123456"</span>)</span><br></pre></td></tr></table></figure></li><li><p>使用用户名称和密码进行建权，建权成功后返回1</p>  <figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.auth</span>(<span class="hljs-string">"zhong"</span>,<span class="hljs-string">"123456"</span>)</span><br><span class="line"><span class="hljs-selector-tag">1</span></span><br></pre></td></tr></table></figure></li><li><p>错误返回</p>  <figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">Error: </span>Authentication failed.</span><br><span class="line">0</span><br></pre></td></tr></table></figure></li></ul><h4 id="启动建权"><a href="#启动建权" class="headerlink" title="启动建权"></a>启动建权</h4><ul><li><p>重启数据库服务器，设置必须使用建权登陆</p>  <figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod <span class="hljs-comment">--auth</span></span><br></pre></td></tr></table></figure></li><li><p>启动后，用户登录只能用用户名和密码进行登录，原来的mongo形式链接已经不起作用了。相应的用户权限也对应妥当。实际项目中我们启动服务器必须使用建权形式</p><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4></li><li><p>如果在配置用户之后，用户想登录，可以使用mongo的形式，不过需要配置用户名密码：</p>  <figure class="highlight dns hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongom  -u zhong -p <span class="hljs-number">123456 127.0</span>.<span class="hljs-number">0.1:27017</span>/admin</span><br></pre></td></tr></table></figure></li><li><p>登陆成功后，我们可以对指定的<code>User</code>数据库进行读写操作，但是对其他数据库只读，这个时候我们修改其他数据库的数据就会报错</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.insert</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;)  <span class="hljs-comment">//这个时test数据库的表</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nInserted"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;一般的在一些项目上,我们都是通过用户来登陆数据库和访问数据库的,这样可以更好的管理用户的权限.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB索引</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/MongoDB%E7%B4%A2%E5%BC%95/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/MongoDB索引/</id>
    <published>2019-08-04T10:14:41.000Z</published>
    <updated>2019-08-04T10:16:02.256Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用索引可以帮助我们更快速的查找到数据，我们现在插入200W条数据到数据库，进行性能的测试。</p></blockquote><a id="more"></a><h2 id="MongoDB索引"><a href="#MongoDB索引" class="headerlink" title="MongoDB索引"></a>MongoDB索引</h2><h3 id="插入200w条数据"><a href="#插入200w条数据" class="headerlink" title="插入200w条数据"></a>插入200w条数据</h3><ul><li><p>我们先插入两百万条数据到数据库中</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-comment">//生成随机数</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandomNumber</span>(<span class="hljs-params">min, max</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> range = max - min</span><br><span class="line">    <span class="hljs-keyword">let</span> rand = <span class="hljs-built_in">Math</span>.random()</span><br><span class="line">    <span class="hljs-keyword">let</span> number = (min + <span class="hljs-built_in">Math</span>.round(rand * range))</span><br><span class="line">    <span class="hljs-keyword">return</span> number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// //生成随机用户名</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandomName</span>(<span class="hljs-params">min, max</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//将每个字符串切割成数组</span></span><br><span class="line">    <span class="hljs-keyword">let</span> userNameString = <span class="hljs-string">"0123456789azqwsxedcrfvtgbyhnujmikolp"</span>.split(<span class="hljs-string">''</span>)</span><br><span class="line">    <span class="hljs-keyword">let</span> outName = <span class="hljs-string">''</span></span><br><span class="line">    <span class="hljs-comment">//定义名字的长度，随机生成区间的长度,每次循环从userNameString取一个数组出来拼接到outName</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; getRandomNumber(min, max); i++) &#123;</span><br><span class="line">        <span class="hljs-comment">//生成名字，从userNameString数组种，随机从0到userNameString数组的长度中抽取</span></span><br><span class="line">        outName = outName + userNameString[getRandomNumber(<span class="hljs-number">0</span>, userNameString.length)]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> outName</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//随机生成200w条数据插入到数据库中</span></span><br><span class="line"><span class="hljs-keyword">var</span> stratTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> DataArray = []</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2000000</span>; i++) &#123;</span><br><span class="line">    DataArray.push(&#123;</span><br><span class="line">        username: getRandomName(<span class="hljs-number">6</span>, <span class="hljs-number">15</span>),</span><br><span class="line">        regeditemTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),</span><br><span class="line">        randNumber: getRandomNumber(<span class="hljs-number">100000</span>, <span class="hljs-number">999999</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)</span><br><span class="line">db.random.drop() <span class="hljs-comment">//先删除数据库，防止数据出错</span></span><br><span class="line">db.random.insert(DataArray)  <span class="hljs-comment">//插入数据</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"><span class="hljs-keyword">var</span> useTime = endTime - stratTime</span><br><span class="line">print(useTime + <span class="hljs-string">"ms"</span>)</span><br></pre></td></tr></table></figure></li><li><p>耗时两分多钟，插入完毕后，我们可以使用<code>db.random.stats()</code>查看数据的条数是否正确，其实在中途我有查看大概的插入时间实际上都在是js在做数组插入工作，少数时间插入到数据库中，这跟我们使用批量插入是离不开的</p><h3 id="查询数据并遍历"><a href="#查询数据并遍历" class="headerlink" title="查询数据并遍历"></a>查询数据并遍历</h3></li><li><p>设计查询程序</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> res = db.random.find(&#123; <span class="hljs-string">"usermae"</span>: <span class="hljs-string">"7xo6cg"</span> &#125;)  <span class="hljs-comment">//使用db.random.find().skip(50000)查询到的一个名字</span></span><br><span class="line">res.forEach(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span><br><span class="line">    printjson(res)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">'查询结束，耗时"'</span> + endTime / <span class="hljs-number">1000</span> + <span class="hljs-string">"s"</span>)  <span class="hljs-comment">//稳定在0.9s</span></span><br></pre></td></tr></table></figure></li><li><p>查询结果</p>  <figure class="highlight puppet hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; load(<span class="hljs-string">'./demo05.js'</span>)</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017/User</span><br><span class="line">Implicit session: <span class="hljs-keyword">session</span> &#123; <span class="hljs-string">"id"</span> : UUID(<span class="hljs-string">"66dab01f-697b-4529-a2d5-106eecf3dbca"</span>) &#125;</span><br><span class="line"><span class="hljs-keyword">MongoDB</span> <span class="hljs-keyword">server</span> <span class="hljs-keyword">version</span>: 4.0.10</span><br><span class="line">查询结束，耗时<span class="hljs-string">"0.928s</span></span><br><span class="line"><span class="hljs-string">true</span></span><br><span class="line"><span class="hljs-string">&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h3><ul><li><p>使用<code>db.数据表名.ensureIndex({&quot;username&quot;:1})</code>来建立索引，1表示true，就是建立索引的意思</p></li><li><p>查看索引：<code>db.数据表名.getIndexes()</code>来查看索引，结果是一个数组，里面有一个对象代表有几个索引，一般地我们不会使用<code>_id</code>因为这个是系统随机生成的不好查找</p></li><li><p>建立索引后查找:</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> res = db.random.find(&#123; <span class="hljs-string">"username"</span>: <span class="hljs-string">"ux5suyundefinednn"</span> &#125;)  <span class="hljs-comment">//使用db.random.find().skip(50000)查询到的一个名字</span></span><br><span class="line">res.forEach(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span><br><span class="line">    printjson(res)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">'查询结束，耗时"'</span> + endTime / <span class="hljs-number">1000</span> + <span class="hljs-string">"s"</span>)  <span class="hljs-comment">//第一次在0.01s之间，以后有查询缓存稳定在0.005s左右</span></span><br></pre></td></tr></table></figure></li><li><p>查询结果:</p>  <figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="hljs-string">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-string">"5d43aefc04d831b959b4175c"</span>),</span><br><span class="line">    <span class="hljs-string">"username"</span> : "<span class="hljs-type">ux5suyundefinednn</span><span class="hljs-string">",</span></span><br><span class="line"><span class="hljs-string">    "</span>regeditemTime<span class="hljs-string">" : ISODate("</span><span class="hljs-number">2019</span>-<span class="hljs-number">08</span>-<span class="hljs-number">02</span>T03:<span class="hljs-number">31</span>:<span class="hljs-number">00.788</span>Z<span class="hljs-string">"),</span></span><br><span class="line"><span class="hljs-string">    "</span>randNumber<span class="hljs-string">" : 806500</span></span><br><span class="line"><span class="hljs-string">&#125;</span></span><br><span class="line"><span class="hljs-string">查询结束，耗时"</span><span class="hljs-number">0.006</span>s</span><br></pre></td></tr></table></figure></li></ul><h4 id="使用索引的注意事项"><a href="#使用索引的注意事项" class="headerlink" title="使用索引的注意事项"></a>使用索引的注意事项</h4><ul><li><p>数据不超万条时，不需要使用索引。性能的提升并不明显，而大大增加了内存和硬盘的消耗。</p></li><li><p>查询数据超过表数据量30%时，不要使用索引字段查询。实际证明会比不使用索引更慢，因为它大量检索了索引表和我们原表。</p></li><li><p>数字索引，要比字符串索引快的多，在百万级甚至千万级数据量面前，使用数字索引是个明确的选择。</p></li><li><p>把你经常查询的数据做成一个内嵌数据（对象型的数据），然后集体进行索引。</p><h3 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h3></li><li><p>两条以上的索引称为符合索引</p></li><li><p>复合索引查询</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> res = db.random.find(&#123; <span class="hljs-string">"username"</span>: <span class="hljs-string">"ux5suyundefinednn"</span>, <span class="hljs-string">"randNumber"</span>: <span class="hljs-number">806500</span> &#125;)</span><br><span class="line"></span><br><span class="line">res.forEach(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span><br><span class="line">    printjson(res)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">'查询成功,耗时'</span> + endTime / <span class="hljs-number">1000</span> + <span class="hljs-string">"s"</span>) <span class="hljs-comment">//第一次耗时0.02s左右,后面查询都为0.01s左右</span></span><br></pre></td></tr></table></figure></li><li><p>默认复合查找的索引顺序其实不是以我们写的索引顺序为准，而是以设置索引的顺序，就是<code>db.数据表.getIndexes()</code>查询到的顺序为准的，但是由于数字所以速度比字符串索引要快，我们有时候需要改变其索引的顺序，就需要使用<code>hint</code>关键字进行优先指定索引查找</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> db = connect(<span class="hljs-string">'User'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> res = db.random.find(&#123; <span class="hljs-string">"username"</span>: <span class="hljs-string">"elhm4th"</span>, <span class="hljs-string">"randNumber"</span>: <span class="hljs-number">364231</span> &#125;).hint(&#123; <span class="hljs-string">"randNumber"</span>: <span class="hljs-number">1</span> &#125;)</span><br><span class="line"></span><br><span class="line">res.forEach(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span><br><span class="line">    printjson(res)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">'查询成功,耗时'</span> + endTime / <span class="hljs-number">1000</span> + <span class="hljs-string">"s"</span>) <span class="hljs-comment">//第一次耗时0.006s左右,后面查询都为0.01s左右</span></span><br></pre></td></tr></table></figure></li><li><p>查询结果：</p>  <figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; load(<span class="hljs-string">'./demo06.js'</span>)</span><br><span class="line">connecting <span class="hljs-string">to:</span> <span class="hljs-string">mongodb:</span><span class="hljs-comment">//127.0.0.1:27017/User</span></span><br><span class="line">Implicit <span class="hljs-string">session:</span> session &#123; <span class="hljs-string">"id"</span> : UUID(<span class="hljs-string">"07312a2c-b849-4862-a53d-6dd796b5cfaf"</span>) &#125;</span><br><span class="line">MongoDB server <span class="hljs-string">version:</span> <span class="hljs-number">4.0</span><span class="hljs-number">.10</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d43af0f04d831b959c2964b"</span>),</span><br><span class="line">        <span class="hljs-string">"username"</span> : <span class="hljs-string">"elhm4th"</span>,</span><br><span class="line">        <span class="hljs-string">"regeditemTime"</span> : ISODate(<span class="hljs-string">"2019-08-02T03:31:40.391Z"</span>),</span><br><span class="line">        <span class="hljs-string">"randNumber"</span> : <span class="hljs-number">364231</span></span><br><span class="line">&#125;</span><br><span class="line">查询成功,耗时<span class="hljs-number">0.005</span>s</span><br><span class="line"><span class="hljs-literal">true</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>在这里其实看不出来有太明显的效果，因为200W条数据太少了</p><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3></li><li><p>有时候我们建立索引错了，需要删除，使用<code>db.数据表.dropIndex(&quot;&quot;)</code>这里的内容填的是索引的名字,使用<code>db.数据表.getIndexes()</code>查询你要删除的索引名字<code>name</code>属性的值，不是<code>key</code>属性的值</p><h3 id="建立全文索引"><a href="#建立全文索引" class="headerlink" title="建立全文索引"></a>建立全文索引</h3></li><li><p>在一些很大的数据中，比如一篇长文，这个时候我们如果想查找文章内容的某一部分，这个时候就需要使用全文索引来帮助我们查找</p></li><li><p>使用<code>db.数据表.ensureIndex({需要建立全文索引的属性:&quot;text&quot;})</code>这里需要跟上<code>text</code>表示建立全文索引，而不是<strong>1或true</strong>表示建立索引</p></li><li><p><strong>全文索引查找</strong>:</p><ol><li>$text:表示要在全文索引中查东西。</li><li>$search:后边跟查找的内容。<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$text</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"programmer"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li></ol></li></ul><h4 id="查找多个词"><a href="#查找多个词" class="headerlink" title="查找多个词:"></a>查找多个词:</h4><ul><li><p>全文索引是支持多个次查找的，比如我们希望查找数据中有programmer，family，diary，drink的数据（这是或的关系），所以两条数据都会出现。</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$text</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"programmer family diary drink"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li><li><p>如果我们这时候希望不查找出来有drink这个单词的记录，我们可以使用“-”减号来取消,就相当于查找的记录要前面的，不要带<code>-</code>的</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbd <span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$text</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"programmer family diary -drink"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li></ul><h4 id="转义符"><a href="#转义符" class="headerlink" title="转义符"></a>转义符</h4><ul><li>全文搜索中是支持转义符的，比如我们想搜索的是两个词（love PlayGame和drink），这时候需要使用\斜杠来转意。  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="hljs-selector-class">.info</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$text</span>:&#123;<span class="hljs-variable">$search</span>:<span class="hljs-string">"\"love PlayGame\" drink"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;使用索引可以帮助我们更快速的查找到数据，我们现在插入200W条数据到数据库，进行性能的测试。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB数据库与数据表数据的增加、删除和修改</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%8A%A0%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E4%BF%AE%E6%94%B9/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/MongoDB数据库与数据表数据的增加、删除和修改/</id>
    <published>2019-08-04T10:13:22.000Z</published>
    <updated>2019-08-04T10:14:21.346Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>数据库中最常用的就是增加数据和修改数据。</p></blockquote><a id="more"></a><h2 id="数据库与数据表的删除和修改"><a href="#数据库与数据表的删除和修改" class="headerlink" title="数据库与数据表的删除和修改"></a>数据库与数据表的删除和修改</h2><h3 id="删除数据表-集合"><a href="#删除数据表-集合" class="headerlink" title="删除数据表(集合)"></a>删除数据表(集合)</h3><ul><li><p>使用:<code>db.表名.drop()</code></p>  <figure class="highlight sqf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs  <span class="hljs-comment">//查看数据库</span></span><br><span class="line">Mrzhong  <span class="hljs-number">0.000</span>GB</span><br><span class="line"><span class="hljs-built_in">admin</span>    <span class="hljs-number">0.000</span>GB</span><br><span class="line">config   <span class="hljs-number">0.000</span>GB</span><br><span class="line"><span class="hljs-built_in">local</span>    <span class="hljs-number">0.000</span>GB</span><br><span class="line">test     <span class="hljs-number">0.000</span>GB</span><br><span class="line">&gt; use Mrzhong  <span class="hljs-comment">//使用数据库</span></span><br><span class="line">switched <span class="hljs-keyword">to</span> db Mrzhong</span><br><span class="line">&gt; show collections <span class="hljs-comment">//查看数据表</span></span><br><span class="line"><span class="hljs-built_in">text</span></span><br><span class="line">user</span><br><span class="line">&gt; db.<span class="hljs-built_in">text</span>.<span class="hljs-built_in">drop</span>() <span class="hljs-comment">//删除数据表</span></span><br><span class="line"><span class="hljs-literal">true</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>如果将一个数据库的数据表全部删除了，那么数据库也会自动删除</p>  <figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs  //查看数据库</span><br><span class="line">Mrzhong  0.000GB</span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line"><span class="hljs-keyword">test     </span>0.000GB</span><br><span class="line">&gt; use Mrzhong  //使用数据库</span><br><span class="line">switched to db Mrzhong</span><br><span class="line">&gt; show collections //查看数据表</span><br><span class="line">text</span><br><span class="line">user</span><br><span class="line">&gt; db.text.drop() //删除数据表</span><br><span class="line">true</span><br><span class="line">&gt; show collections</span><br><span class="line">user</span><br><span class="line">&gt; db.user.drop() //删除数据表</span><br><span class="line">true</span><br><span class="line">&gt; show dbs  //查看数据库</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="hljs-keyword">test    </span>0.000GB</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><ul><li>删除当前所在的数据库，使用<code>db.数据库名称.dropDatabase()</code></li><li>进行删除  <figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs  //查看数据库</span><br><span class="line">MyDb    0.000GB</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="hljs-keyword">test    </span>0.000GB</span><br><span class="line">&gt; use MyDb  //使用数据库</span><br><span class="line">switched to db MyDb</span><br><span class="line">&gt; db</span><br><span class="line">MyDb</span><br><span class="line">&gt; db.dropDatabase() //删除数据库</span><br><span class="line">&#123; "dropped" : "MyDb", "ok" : 1 &#125;</span><br><span class="line">&gt; show dbs  //再次查看数据库</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="hljs-keyword">test    </span>0.000GB</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="修改数据表的数据"><a href="#修改数据表的数据" class="headerlink" title="修改数据表的数据"></a>修改数据表的数据</h3><ul><li><p>使用<code>db.数据表.update({修改的条件},{$set:{修改的内容}})</code></p></li><li><p><code>update</code>接收的参数update({更新条件},{更新的数据},不符合条件的时候是否增加条件(true),是否更新全部(true))</p></li><li><p>db.user.update({“sex”:”男”},{$set:{“money”:1000}},false,true) – 表示查找性别为男的数据，新增一个money属性。属性值为1000，如果没有查到数据不增加条件，将满足条件的全部更新</p></li><li><p>比如：我们将以下数据表的内容的<code>name</code>改成<code>zs666</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-variable">$set</span>:&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs666"</span>&#125;&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42a57e96bf23841b62eabd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs666"</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>这样就修改成功了</p><h3 id="替换数据表中的数据"><a href="#替换数据表中的数据" class="headerlink" title="替换数据表中的数据"></a>替换数据表中的数据</h3></li><li><p>使用<code>db.数据表.update({替换的条件},{替换的内同})</code></p></li><li><p>如将下面的数据表的内容替换成<code>{&quot;name&quot;:&#39;ls&#39;,&quot;age&quot;::20}</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs666"</span>&#125;,&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"ls"</span>,age:<span class="hljs-number">20</span>&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42a57e96bf23841b62eabd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除数据表中的数据"><a href="#删除数据表中的数据" class="headerlink" title="删除数据表中的数据"></a>删除数据表中的数据</h3><ul><li><p>使用<code>db.数据表.remove({删除条件})</code></p></li><li><p>比如我们删除<code>name=&quot;ls&quot;</code>的数据</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()  <span class="hljs-comment">//删除前</span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42a57e96bf23841b62eabd"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.remove</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"ls"</span>&#125;)  <span class="hljs-comment">//删除</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nRemoved"</span> : <span class="hljs-number">1</span> &#125;)</span></span> </span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()<span class="hljs-comment">//删除后，因为每页数据了，所以没有显示</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>如果数据表中有多条数据符合删除条件，那么都会被删除，如果我们只想要删除一个可以这样删除<code>db.数据表.update({删除条件},{justOne:true})</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42abf696bf23841b62eabe"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42abfa96bf23841b62eabf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.remove</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"ls"</span>&#125;,&#123;justOne:true&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nRemoved"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42abfa96bf23841b62eabf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="数组属性修改"><a href="#数组属性修改" class="headerlink" title="数组属性修改"></a>数组属性修改</h3><ul><li><p>如果数据表中有数据是一个数组形式的，比如一个人的爱好，如果我们需要删除爱好中的最后几个或者前面几个，我们可以使用<code>$pop</code>来删除，它接收1或-1，整数表示从末端删除，负数表示从开头删除</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()  <span class="hljs-comment">//删除前</span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打篮球"</span>, <span class="hljs-string">"踢足球"</span>, <span class="hljs-string">"唱歌"</span> ] &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-variable">$pop</span>:&#123;<span class="hljs-string">"like"</span>:<span class="hljs-number">1</span>&#125;&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>() <span class="hljs-comment">//删除后</span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打篮球"</span>, <span class="hljs-string">"踢足球"</span> ] &#125;</span><br></pre></td></tr></table></figure></li><li><p>有时候我们需要修改数组中的某一项替换成别的数据，比如爱好写错了，我们需要修改，这个时候我们就需要使用数组定位修改，比如将爱好中的游戏修改成电脑游戏</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>() <span class="hljs-comment">//修改前</span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打篮球"</span>, <span class="hljs-string">"踢足球"</span> ] &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-variable">$set</span>:&#123;<span class="hljs-string">"like.1"</span>:<span class="hljs-string">"电脑游戏"</span>&#125;&#125;) <span class="hljs-comment">//修改like.1表示修改like数组中的第一项，数组是0开始的</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>() <span class="hljs-comment">//修改后</span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"电脑游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打 篮球"</span>, <span class="hljs-string">"踢足球"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="数组查询"><a href="#数组查询" class="headerlink" title="数组查询"></a>数组查询</h3><ul><li><p>有时候我们需要查询数组中含有某些特定值的数据，如果我们想知道有那些人的爱好是画画的,并且只显示它的爱好有哪些</p>  <figure class="highlight smalltalk hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.find(&#123;<span class="hljs-comment">"like"</span>:<span class="hljs-comment">"游泳"</span>&#125;,&#123;<span class="hljs-comment">"like"</span>:<span class="hljs-keyword">true</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-comment">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-comment">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-comment">"like"</span> : [ <span class="hljs-comment">"游泳"</span>, <span class="hljs-comment">"电脑游戏"</span>, <span class="hljs-comment">"写代码"</span>, <span class="hljs-comment">"打篮球"</span>, <span class="hljs-comment">"踢足球"</span> ] &#125;</span><br></pre></td></tr></table></figure></li><li><p>但是有时候我们需要即会游泳、又会写代码的，那么这个时候上面的查询不能满足我们的需求，所以需要使用<code>$all</code>来查询</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"like"</span>:&#123;<span class="hljs-variable">$all</span>:[<span class="hljs-string">"游泳"</span>,<span class="hljs-string">"写代码"</span>]&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"电脑游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打 篮球"</span>, <span class="hljs-string">"踢足球"</span> ], <span class="hljs-string">"money"</span> : <span class="hljs-number">1000</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>有时候我们需要满足其中一项就可以的，需要使用<code>$in</code>来查询</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"like"</span>:&#123;<span class="hljs-variable">$in</span>:[<span class="hljs-string">"游泳"</span>,<span class="hljs-string">"写代码"</span>]&#125;&#125;))</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"电脑游戏"</span>, <span class="hljs-string">"写代码"</span>, <span class="hljs-string">"打 篮球"</span>, <span class="hljs-string">"踢足球"</span> ], <span class="hljs-string">"money"</span> : <span class="hljs-number">1000</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>有时候我们需要只有一个爱好的,使用<code>$size</code>来查询</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"like"</span>:&#123;<span class="hljs-variable">$size</span>:<span class="hljs-number">1</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42ddad677cf75a716796c6"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"money"</span> : <span class="hljs-number">1000</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"跑步"</span> ] &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>有时候我们需要只需要爱好中的第一项，使用<code>$slice</code>来进行处理,如果需要查询最后一项，使用负数就可以了</p>  <figure class="highlight smalltalk hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.find(&#123;<span class="hljs-comment">"age"</span>:<span class="hljs-number">20</span>&#125;,&#123;<span class="hljs-comment">"like"</span>:&#123;<span class="hljs-string">$s</span>lice:<span class="hljs-number">1</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-comment">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-comment">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-comment">"name"</span> : <span class="hljs-comment">"zs"</span>, <span class="hljs-comment">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-comment">"like"</span> : [ <span class="hljs-comment">"游泳"</span> ], <span class="hljs-comment">"money"</span> : <span class="hljs-number">1000</span> &#125;</span><br><span class="line">&#123; <span class="hljs-comment">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-comment">"5d42ddad677cf75a716796c6"</span>), <span class="hljs-comment">"name"</span> : <span class="hljs-comment">"ls"</span>, <span class="hljs-comment">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-comment">"money"</span> : <span class="hljs-number">1000</span>, <span class="hljs-comment">"like"</span> : [ <span class="hljs-comment">"跑步"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="增加数据表中的数据"><a href="#增加数据表中的数据" class="headerlink" title="增加数据表中的数据"></a>增加数据表中的数据</h3><ul><li>有时候我们需要对表中的数据进行增加操作，使用<code>db.数据表.update({增加条件},{$push:{要增加的数据}})</code>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span> &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-variable">$push</span>:&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">20</span>,<span class="hljs-string">"sex"</span>:<span class="hljs-string">"男"</span>&#125;&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()                                            )</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : [ <span class="hljs-number">20</span> ], <span class="hljs-string">"sex"</span> : [ <span class="hljs-string">"男"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="判断后增加数据或不增加数据"><a href="#判断后增加数据或不增加数据" class="headerlink" title="判断后增加数据或不增加数据"></a>判断后增加数据或不增加数据</h3><ul><li><p>有时候我们需要对表中的数据进行判断数据，比如爱好，查看爱好中是否有某个选项，有则不添加，没有则添加，那么使用<code>$ne</code>可以来处理这个查询</p>  <figure class="highlight stata hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &gt; <span class="hljs-keyword">db</span>.user.find()           <span class="hljs-comment">//查看数据  </span></span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>] &#125;</span><br><span class="line">&gt; <span class="hljs-keyword">db</span>.user.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>,like:&#123;<span class="hljs-variable">$ne</span>:<span class="hljs-string">"游戏"</span>&#125;&#125;,&#123;<span class="hljs-variable">$push</span>:&#123;like:<span class="hljs-string">"游戏"</span>&#125;&#125;) <span class="hljs-comment">//查看爱好中是否有游泳，没有则使用$push添加</span></span><br><span class="line">WriteResult(&#123; <span class="hljs-string">"nMatched"</span> : 1, <span class="hljs-string">"nUpserted"</span> : 0, <span class="hljs-string">"nModified"</span> : 1 &#125;)</span><br><span class="line">&gt; <span class="hljs-keyword">db</span>.user.find()                                                   "&#125;&#125;))</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : 20, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span> ] &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>但是上面的方式用来增加数据过于麻烦，我们可以使用<code>$addToSet</code>来做这个功能，上述的<code>$ne</code>修饰符做其他功能较为合适</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span> ] &#125;</span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.update</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-variable">$addToSet</span>:&#123;<span class="hljs-string">"like"</span>:<span class="hljs-string">"写代码"</span>&#125;&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nMatched"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"nUpserted"</span> : <span class="hljs-number">0</span>, <span class="hljs-string">"nModified"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()                                          &#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42cdf7677cf75a716796c5"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span>, <span class="hljs-string">"like"</span> : [ <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"写代码"</span> ] &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="自定义数据id"><a href="#自定义数据id" class="headerlink" title="自定义数据id"></a>自定义数据id</h3><ul><li><p>在mongodb中，数据库默认会给给我们添加一个id，而且是不重复的，但是很多时候我们需要使用id进行数据增删改查，所以我们可以自己定义id</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.insert</span>(&#123;<span class="hljs-string">"_id"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"wangmazi"</span>,<span class="hljs-string">"age"</span>:<span class="hljs-number">20</span>&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">WriteResult</span><span class="hljs-params">(&#123; <span class="hljs-string">"nInserted"</span> : <span class="hljs-number">1</span> &#125;)</span></span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42abfa96bf23841b62eabf"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span> : <span class="hljs-string">"wangmazi"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li><li><p>插入id其实和插入其他数据一样，一直插入即可，如果id有重复的话，那么它会报错的</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;数据库中最常用的就是增加数据和修改数据。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB查询数据表</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/MongoDB%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E8%A1%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/MongoDB查询数据表/</id>
    <published>2019-08-04T10:11:05.000Z</published>
    <updated>2019-08-04T10:12:44.919Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在所有数据库中，查询数据表都是一些操作数据库的最基本操作。</p></blockquote><a id="more"></a><h3 id="查询数据表"><a href="#查询数据表" class="headerlink" title="查询数据表"></a>查询数据表</h3><h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><ul><li><p>查询名字为:<code>zs</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;name:<span class="hljs-string">'zs'</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询年龄<code>大于20</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$gt</span>:<span class="hljs-number">20</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询年龄<code>小于20</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$lt</span>:<span class="hljs-number">20</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询年龄<code>大于等于12</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$gte</span>:<span class="hljs-number">12</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询年龄<code>小于等于12</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$lte</span>:<span class="hljs-number">12</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>如果有名字相同的时候，我们需要多个条件查询</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>,<span class="hljs-string">"age"</span>:<span class="hljs-number">12</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询年龄<code>大于10岁小于30</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$gt</span>:<span class="hljs-number">20</span>,<span class="hljs-variable">$lt</span>:<span class="hljs-number">30</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><ul><li><p>如下一个数据表，有以下数据</p>  <figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.text.find()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-string">"5d42504fe28fa15fcd55b0d5"</span>), <span class="hljs-string">"title"</span> : "精品男装、时尚" &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-string">"5d425077e28fa15fcd55b0d6"</span>), <span class="hljs-string">"title"</span> : "精品女装包包、潮流" &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-string">"5d425085e28fa15fcd55b0d7"</span>), <span class="hljs-string">"title"</span> : "精品女装皮靴、<span class="hljs-type">g</span>复古<span class="hljs-string">" &#125;</span></span><br><span class="line"><span class="hljs-string">&#123; "</span>_id<span class="hljs-string">" : ObjectId("</span><span class="hljs-number">5</span>d4250a7e28fa15fcd55b0d8<span class="hljs-string">"), "</span>title<span class="hljs-string">" : "</span>精品男装牛仔裤、韩国风<span class="hljs-string">" &#125;</span></span><br></pre></td></tr></table></figure><ul><li>查询含有<code>男装</code>的数据<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.text</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"title"</span>:/男装/&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d42504fe28fa15fcd55b0d5"</span>), <span class="hljs-string">"title"</span> : <span class="hljs-string">"精品男装、时尚"</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4250a7e28fa15fcd55b0d8"</span>), <span class="hljs-string">"title"</span> : <span class="hljs-string">"精品男装牛仔裤、韩国风"</span> &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>查询含有<code>女装</code>的数据</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.text</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"title"</span>:/女装/&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425077e28fa15fcd55b0d6"</span>), <span class="hljs-string">"title"</span> : <span class="hljs-string">"精品女装包包、潮流"</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425085e28fa15fcd55b0d7"</span>), <span class="hljs-string">"title"</span> : <span class="hljs-string">"精品女装皮靴、g复古"</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字以<code>z</code>开头的</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//数据表</span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//查询后</span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"name"</span>:/^z/&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字以<code>g</code>结尾的</p>  <figure class="highlight elixir hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.find(&#123;<span class="hljs-string">"name"</span><span class="hljs-symbol">:/g</span><span class="hljs-variable">$/</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="查询指定列"><a href="#查询指定列" class="headerlink" title="查询指定列"></a>查询指定列</h4><ul><li>查询name，第一个字段是条件，第二个是指定列  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;,&#123;name:<span class="hljs-number">1</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="升序降序"><a href="#升序降序" class="headerlink" title="升序降序"></a>升序降序</h4><ul><li><p>按照年龄升序排序</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).sort(&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">1</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>按照年龄降序排序</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).sort(&#123;<span class="hljs-string">"age"</span>:-<span class="hljs-number">1</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="查询指定条数数据"><a href="#查询指定条数数据" class="headerlink" title="查询指定条数数据"></a>查询指定条数数据</h4><ul><li><p>查询前2条数据并降序(当然也可以先排序再数据)</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).limit(<span class="hljs-number">2</span>).sort(&#123;<span class="hljs-string">"age"</span>:-<span class="hljs-number">1</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询第3条以后的数据并升序</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).skip(<span class="hljs-number">2</span>).sort(&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">1</span>&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><ul><li><p>查询第几页，每页多少条数据，可以用来做分页查询  skip表示的是从第几条数据开始，从0开始计算，limit表示截取几条数据,假设我们以下数据</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>如果我们将这个数据分成两页，那么第一页就是<code>skip(0).limit(2)</code>,第二页就是<code>skip(2).limit(2)</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//第一页</span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).skip(<span class="hljs-number">0</span>).limit(<span class="hljs-number">2</span>)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//第二页</span></span><br><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;&#125;).skip(<span class="hljs-number">2</span>).limit(<span class="hljs-number">2</span>)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>如果有100条数据，每页10条那么我们可以这样进行切割 skip((页数-1)*10).limit(10)</p><h3 id="or与查询"><a href="#or与查询" class="headerlink" title="or与查询"></a>or与查询</h3></li><li><p>当我们查询条件是具体的时候，但是又是多个的时候，以上查询方式并不适合我们，比如：查询<code>age:20</code>或者<code>age:24</code>这种情况，我们就需要使用  <strong>$or</strong>来查询</p></li><li><p>查询年龄<code>age=20</code>或者<code>age=22</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$or</span>:[&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">20</span>&#125;,&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">22</span>&#125;]&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字为<code>zs</code>或者<code>age=20</code></p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-variable">$or</span>:[&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"zs"</span>&#125;,&#123;<span class="hljs-string">"age"</span>:<span class="hljs-number">20</span>&#125;]&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424e06e28fa15fcd55b0d4"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">20</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>使用 $or查询，如果有多个筛选项那么只需要满足一项即可，如果不适用$or表示并且，就需要都满足</p><h3 id="查询一条数据"><a href="#查询一条数据" class="headerlink" title="查询一条数据"></a>查询一条数据</h3></li><li><p>使用findOne()查询时返回第一个数据</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.findOne</span>()</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d4246624239b28d6b556da7"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zs"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">12</span> &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="查询结果符合的条数"><a href="#查询结果符合的条数" class="headerlink" title="查询结果符合的条数"></a>查询结果符合的条数</h3><ul><li><p>有时候我们用于统计，比如查询年龄大于20岁的有多少人，但是不需要具体的姓名性别等信息</p>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$gt</span>:<span class="hljs-number">20</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d424ba1e28fa15fcd55b0d3"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"ls"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">25</span> &#125;</span><br><span class="line">&#123; <span class="hljs-string">"_id"</span> : ObjectId(<span class="hljs-string">"5d425231e28fa15fcd55b0d9"</span>), <span class="hljs-string">"name"</span> : <span class="hljs-string">"zhong"</span>, <span class="hljs-string">"age"</span> : <span class="hljs-number">22</span> &#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.find</span>(&#123;<span class="hljs-string">"age"</span>:&#123;<span class="hljs-variable">$gt</span>:<span class="hljs-number">20</span>&#125;&#125;).count()</span><br><span class="line"><span class="hljs-number">2</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在所有数据库中，查询数据表都是一些操作数据库的最基本操作。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>启动MongoDB</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/%E5%90%AF%E5%8A%A8MongoDB/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/启动MongoDB/</id>
    <published>2019-08-04T10:08:12.000Z</published>
    <updated>2019-08-04T10:11:42.768Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mongodb是在非关系型数据库中最接近关系型数据库的，关系型数据库能实现的功能MongoDb基本上都可以实现。</p></blockquote><a id="more"></a><h2 id="启动MongoDB"><a href="#启动MongoDB" class="headerlink" title="启动MongoDB"></a>启动MongoDB</h2><ul><li>安装完成后使用<code>mongod</code>启动数据库</li><li>连接:<code>mongo</code>连接数据库</li><li>连接远程数据库:<code>mongo ip:端口</code></li><li>查询数据库 ：<code>show dbs</code></li><li>定位当前数据库:<code>db</code></li><li>使用数据库(创建数据库):<code>use 数据库名</code></li><li>查询数据表:<code>show collections</code></li><li>向表中插入数据(创建表):<code>db.表名.insert({&quot;name&quot;:&quot;zs&quot;,&quot;age&quot;:12})</code></li><li>查询数据表的内容:<code>db.数据表.find()</code></li></ul><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ul><li>mongodb数据库没有创建表和数据库的指令，你直接当做有就行，没有自己会创建，有就直接使用</li><li>数据表使用json格式的字符串</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mongodb是在非关系型数据库中最接近关系型数据库的，关系型数据库能实现的功能MongoDb基本上都可以实现。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://zhongyuehui.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>React-redux的Provider和connect</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/React-redux%E7%9A%84Provider%E5%92%8Cconnect/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/React-redux的Provider和connect/</id>
    <published>2019-08-04T10:05:24.000Z</published>
    <updated>2019-08-04T10:07:08.396Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Provider和connect可以帮助我们更方便的获取数据。</p></blockquote><a id="more"></a><h2 id="React-redux的Provider和connect"><a href="#React-redux的Provider和connect" class="headerlink" title="React-redux的Provider和connect"></a>React-redux的Provider和connect</h2><h3 id="提供器Provider的使用"><a href="#提供器Provider的使用" class="headerlink" title="提供器Provider的使用"></a>提供器Provider的使用</h3><ul><li>使用Provider可以让在<provider></provider>标签内的所有组件和元素都可以访问store</li><li>很简单，我们在项目的index.js中使用Provider  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> TodoList <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/TodoList.jsx'</span></span><br><span class="line"><span class="hljs-keyword">import</span> &#123; Provider &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span></span><br><span class="line"><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/index'</span></span><br><span class="line"><span class="hljs-keyword">const</span> App = (</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        <span class="hljs-comment">// Provider包裹的元素都可以使用store</span></span><br><span class="line">        &lt;TodoList&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">TodoList</span>&gt;</span></span></span><br><span class="line">    &lt;<span class="hljs-regexp">/Provider&gt;</span></span><br><span class="line"><span class="hljs-regexp">)</span></span><br><span class="line"><span class="hljs-regexp">ReactDOM.render(App, document.getElementById('root'));</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="连接器connect的使用"><a href="#连接器connect的使用" class="headerlink" title="连接器connect的使用"></a>连接器connect的使用</h3><ul><li>使用connect映射store中的对应数据,这时候不需要在使用state来获取store的数据，它会变成props属性，我们直接根据映射关系就可以拿到值  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//TodoList.jsx</span></span><br><span class="line"><span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> &#123; Button, Input &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> &#123; connect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Input style=&#123;&#123; <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> &#125;&#125; placeholder=&#123;<span class="hljs-keyword">this</span>.props.inputValue&#125; /&gt;</span><br><span class="line">        &lt;Button type=<span class="hljs-string">"primary"</span>&gt;按钮&lt;<span class="hljs-regexp">/Button&gt;</span></span><br><span class="line"><span class="hljs-regexp">        &lt;ul&gt;</span></span><br><span class="line"><span class="hljs-regexp">          &lt;li&gt;今天天气真不错！&lt;/</span>li&gt;</span><br><span class="line">          &lt;li&gt;万里无云&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">        &lt;/u</span>l&gt;</span><br><span class="line">      &lt;<span class="hljs-regexp">/div&gt;</span></span><br><span class="line"><span class="hljs-regexp">    );</span></span><br><span class="line"><span class="hljs-regexp">  &#125;</span></span><br><span class="line"><span class="hljs-regexp">&#125;</span></span><br><span class="line"><span class="hljs-regexp">const StateToProps = state =&gt; &#123;</span></span><br><span class="line"><span class="hljs-regexp">  return &#123;</span></span><br><span class="line"><span class="hljs-regexp">    inputValue: state.inputValue /</span><span class="hljs-regexp">/这里其实就是一个映射关系</span></span><br><span class="line"><span class="hljs-regexp">  &#125;;</span></span><br><span class="line"><span class="hljs-regexp">&#125;;</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">export default connect(</span></span><br><span class="line"><span class="hljs-regexp">  StateToProps,</span></span><br><span class="line"><span class="hljs-regexp">  null</span></span><br><span class="line"><span class="hljs-regexp">)(TodoList);</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Provider和connect可以帮助我们更方便的获取数据。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="React" scheme="https://zhongyuehui.github.io/categories/React/"/>
    
    
      <category term="React" scheme="https://zhongyuehui.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React-redux的使用</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/React-redux%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/React-redux的使用/</id>
    <published>2019-08-04T10:02:27.000Z</published>
    <updated>2019-08-04T10:05:06.848Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>React-Redux这是一个React生态中常用组件，它可以简化Redux流程</p></blockquote><a id="more"></a><h2 id="React-redux的使用"><a href="#React-redux的使用" class="headerlink" title="React-redux的使用"></a>React-redux的使用</h2><ul><li><p>安装：<code>yarn add react-redux</code></p></li><li><p>初始化store，src/store/index.js</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123;createStore&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></span><br><span class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> store = createStore(reducer)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store</span><br></pre></td></tr></table></figure></li><li><p>src/store/reducer.js</p>  <figure class="highlight pf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const defalueState = &#123;</span><br><span class="line">inputValue: 'Mr zhong',</span><br><span class="line">list: []</span><br><span class="line">&#125;</span><br><span class="line">export <span class="hljs-keyword">default</span> (<span class="hljs-keyword">state</span> = defalueState, action) =&gt; &#123;</span><br><span class="line">    return <span class="hljs-keyword">state</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>初始化完毕后在需要使用的组件中引用store</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//TodoList.jsx</span></span><br><span class="line"><span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> &#123; Button, Input &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"../store/index"</span>;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="hljs-keyword">super</span>(props);</span><br><span class="line">    <span class="hljs-keyword">this</span>.state = store.getState();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Input style=&#123;&#123; <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> &#125;&#125; placeholder=&#123;<span class="hljs-keyword">this</span>.state.inputValue&#125; /&gt;</span><br><span class="line">        &lt;Button type=<span class="hljs-string">"primary"</span>&gt;按钮&lt;<span class="hljs-regexp">/Button&gt;</span></span><br><span class="line"><span class="hljs-regexp">        &lt;ul&gt;</span></span><br><span class="line"><span class="hljs-regexp">          &lt;li&gt;今天天气真不错！&lt;/</span>li&gt;</span><br><span class="line">          &lt;li&gt;万里无云&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">        &lt;/u</span>l&gt;</span><br><span class="line">      &lt;<span class="hljs-regexp">/div&gt;</span></span><br><span class="line"><span class="hljs-regexp">    );</span></span><br><span class="line"><span class="hljs-regexp">  &#125;</span></span><br><span class="line"><span class="hljs-regexp">&#125;</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure></li><li><p>初始化完毕！</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;React-Redux这是一个React生态中常用组件，它可以简化Redux流程&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="React" scheme="https://zhongyuehui.github.io/categories/React/"/>
    
    
      <category term="React" scheme="https://zhongyuehui.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Redux-thunk的使用</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Redux-thunk%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Redux-thunk的使用/</id>
    <published>2019-08-04T09:53:06.000Z</published>
    <updated>2019-08-04T09:54:07.091Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>配置好Redux-thun接下来我就看看如何使用Redux-thun。</p></blockquote><a id="more"></a><h2 id="Redux-thunk的使用"><a href="#Redux-thunk的使用" class="headerlink" title="Redux-thunk的使用"></a>Redux-thunk的使用</h2><ul><li><p>Redux-thunk就是redux的中间件插件</p></li><li><p>安装:<code>cnpm i -S redux-thunk</code></p><h3 id="使用Redux-thunk处理异步任务"><a href="#使用Redux-thunk处理异步任务" class="headerlink" title="使用Redux-thunk处理异步任务"></a>使用Redux-thunk处理异步任务</h3></li><li><p>我们在请求数据的时候，在componentWillMount()生命周期函数中来请求数据，如果请求的数据过多，那么这个生命周期函数显得非常臃肿，所以我们需要把这个异步请求放到单独的一个文件中，其实异步请求我们需要它返回的就是一个action，然后，在componentWillMount生命周期函数中调用就可以得到数据放到store中</p></li><li><p>因为我们把所有的action逻辑都放在了actionCreatros.js，所以我们在这里编辑异步请求</p>  <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123; ADD_ITEM, CHANGE_INPUT, DELETE_ITEM, GET_LIST &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./actionTypes'</span></span><br><span class="line"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> changeInput = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="hljs-keyword">type</span>: CHANGE_INPUT,</span><br><span class="line">    value</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addItem = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="hljs-keyword">type</span>: ADD_ITEM,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteItem = <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="hljs-keyword">type</span>: DELETE_ITEM,</span><br><span class="line">    index</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getListAction = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="hljs-keyword">type</span>: GET_LIST,</span><br><span class="line">    data</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getListData = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        axios</span><br><span class="line">            .get(</span><br><span class="line">                <span class="hljs-string">"https://www.easy-mock.com/mock/5d3fb5919101bd556dbe67cc/getlists/lists"</span></span><br><span class="line">            )</span><br><span class="line">            .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">const</span> data = getListAction(res.data.data.list)  <span class="hljs-comment">//调用上面的函数，这样就返回了一个我们想要的对象格式</span></span><br><span class="line">                dispatch(data)  <span class="hljs-comment">//这里可以在参数中定义dispatch，就不用写store。dispatch</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(error));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>这样我们的TodoList.jsx文件就变成这样</p>  <figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> React, &#123; Component &#125; from <span class="hljs-string">"react"</span>;</span><br><span class="line"><span class="hljs-comment">//引入store</span></span><br><span class="line"><span class="hljs-keyword">import</span> store from <span class="hljs-string">"../store/index"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//引入actionCreatros.js</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> &#123;</span><br><span class="line">  changeInput,</span><br><span class="line">  deleteItem,</span><br><span class="line">  addItem,</span><br><span class="line">  getListData</span><br><span class="line">&#125; from <span class="hljs-string">"../store/actionCreatros"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//引入ui组件</span></span><br><span class="line"><span class="hljs-keyword">import</span> TodoListUI from <span class="hljs-string">"./TodoListUI.jsx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoList</span> <span class="hljs-title">extends</span> <span class="hljs-title">Component</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="hljs-keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//使用getstore()方法可以获取store的数据，就是存到store的数据</span></span><br><span class="line">    <span class="hljs-keyword">this</span>.state = store.getState();</span><br><span class="line">    console.log(store.getState());</span><br><span class="line">    <span class="hljs-keyword">this</span>.changeValue = <span class="hljs-keyword">this</span>.changeValue.bind(<span class="hljs-keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">this</span>.storeChange = <span class="hljs-keyword">this</span>.storeChange.bind(<span class="hljs-keyword">this</span>);</span><br><span class="line">    <span class="hljs-comment">//订阅state，调用storeChange这个方法</span></span><br><span class="line">    store.subscribe(<span class="hljs-keyword">this</span>.storeChange);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">this</span>.deleteItem = <span class="hljs-keyword">this</span>.deleteItem.bind(<span class="hljs-keyword">this</span>);</span><br><span class="line">    <span class="hljs-keyword">this</span>.addList = <span class="hljs-keyword">this</span>.addList.bind(<span class="hljs-keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (</span><br><span class="line">      &lt;TodoListUI</span><br><span class="line">        changeValue=&#123;<span class="hljs-keyword">this</span>.changeValue&#125;</span><br><span class="line">        addList=&#123;<span class="hljs-keyword">this</span>.addList&#125;</span><br><span class="line">        deleteItem=&#123;<span class="hljs-keyword">this</span>.deleteItem&#125;</span><br><span class="line">        inputValue=&#123;<span class="hljs-keyword">this</span>.state.inputValue&#125;</span><br><span class="line">        list=&#123;<span class="hljs-keyword">this</span>.state.list&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">//实现store数据从服务端得到，然后存放到store中</span></span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> action = getListData();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  storeChange() &#123;</span><br><span class="line">    <span class="hljs-comment">//重新设置state为最新的store</span></span><br><span class="line">    <span class="hljs-keyword">this</span>.setState(store.getState());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  changeValue(e) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> action = changeInput(e.target.value);</span><br><span class="line">    store.dispatch(action); <span class="hljs-comment">//使用dispatch方法将action传递过去store就可以接收到值了,store接收到得值会直接发送到reducer中</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">//点击增加按钮，增加数据到列表中</span></span><br><span class="line">  addList() &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> action = addItem();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-comment">//点击列表项进行删除</span></span><br><span class="line">  deleteItem(index) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> action = deleteItem(index);</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="hljs-keyword">default</span> TodoList;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;配置好Redux-thun接下来我就看看如何使用Redux-thun。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Redux" scheme="https://zhongyuehui.github.io/categories/Redux/"/>
    
    
      <category term="Redux" scheme="https://zhongyuehui.github.io/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>Redux-thunk中间件的配置</title>
    <link href="https://zhongyuehui.github.io/2019/08/04/Redux-thunk%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
    <id>https://zhongyuehui.github.io/2019/08/04/Redux-thunk中间件的配置/</id>
    <published>2019-08-04T09:51:40.000Z</published>
    <updated>2019-08-04T09:52:51.444Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redux-thunk是Redux的一个插件，可以帮助我们更好的使用Redux。</p></blockquote><a id="more"></a><h2 id="Redux-thunk中间件的配置"><a href="#Redux-thunk中间件的配置" class="headerlink" title="Redux-thunk中间件的配置"></a>Redux-thunk中间件的配置</h2><ul><li><p>在redux中需要使用redux-thunk的话，需要在store/index.js中配置一下</p></li><li><p>配置如下：</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-comment">// 1. 引入applyMiddleware、compose</span></span><br><span class="line"><span class="hljs-keyword">import</span> &#123; createStore, applyMiddleware, compose &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></span><br><span class="line"><span class="hljs-comment">//引入reducer</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span></span><br><span class="line"><span class="hljs-comment">// 2.引入redux-thunk</span></span><br><span class="line"><span class="hljs-keyword">import</span> thunk <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-thunk'</span></span><br><span class="line"><span class="hljs-comment">//3.由于createStore中只能接收两个参数，如果将applyMiddleware(thunk)直接放到参数中，那么我们配置的redux调试工具就无法执行</span></span><br><span class="line"><span class="hljs-comment">//所以这个时候我们需要增强函数，redux已经帮助我们提供这个功能了</span></span><br><span class="line"><span class="hljs-keyword">const</span> store = createStore(</span><br><span class="line">    reducer,</span><br><span class="line">    applyMiddleware(thunk),</span><br><span class="line">    <span class="hljs-built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; <span class="hljs-built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__())</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//暴露</span></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store</span><br></pre></td></tr></table></figure></li><li><p>以上这种方式会导致我们配置的redux失效，因为它只能接收两个参数</p></li><li><p>使用增强函数配置redux-thunk</p>  <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-comment">// 1. 引入applyMiddleware、compose</span></span><br><span class="line"><span class="hljs-keyword">import</span> &#123; createStore, applyMiddleware, compose &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></span><br><span class="line"><span class="hljs-comment">//引入reducer</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span></span><br><span class="line"><span class="hljs-comment">// 2.引入redux-thunk</span></span><br><span class="line"><span class="hljs-keyword">import</span> thunk <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-thunk'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//判断是否有redux调试的配置项</span></span><br><span class="line"><span class="hljs-keyword">const</span> composeEnhancers = <span class="hljs-built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="hljs-built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(&#123;&#125;) : compose</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> enhancer = composeEnhancers(applyMiddleware(thunk))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//3.由于createStore中只能接收两个参数，如果将applyMiddleware(thunk)直接放到参数中，那么我们配置的redux调试工具就无法执行</span></span><br><span class="line"><span class="hljs-comment">//所以这个时候我们需要增强函数，redux已经帮助我们提供这个功能了</span></span><br><span class="line"><span class="hljs-keyword">const</span> store = createStore(</span><br><span class="line">    reducer,</span><br><span class="line">    enhancer</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//暴露</span></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store</span><br></pre></td></tr></table></figure></li><li><p>这样就配置完成了</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Redux-thunk是Redux的一个插件，可以帮助我们更好的使用Redux。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Redux" scheme="https://zhongyuehui.github.io/categories/Redux/"/>
    
    
      <category term="Redux" scheme="https://zhongyuehui.github.io/tags/Redux/"/>
    
  </entry>
  
</feed>
